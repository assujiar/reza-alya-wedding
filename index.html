<!doctype html>
<!-- SAVE AS: undangan-reza-alya.html -->
<!--
CHECKLIST (QUALITY GATE)
[✓] Single file (HTML+CSS+JS), Vanilla JS only, no external JS libs
[✓] Max 1 Google Font (judul serif), body system font
[✓] Dark luxury charcoal gradient + subtle noise texture via CSS (tanpa gambar eksternal)
[✓] Layout 1 kolom saja (max-width 720–820px), desktop tetap 1 kolom (no split)
[✓] Gate overlay: “Kepada Yth. Dimas Budi Ramadhan” muncul sebelum undangan terbuka
[✓] Musik default OFF; hanya bisa play setelah tap Gate atau tombol musik
[✓] Photo system: per section pakai 1 photo panel (tanpa galeri), auto swap via IntersectionObserver
[✓] Crossfade 2-layer (img A/B) + slight zoom + blur-to-sharp, 500–900ms
[✓] Section separator filigree (inline SVG) fade-in on viewport; reduced-motion dihormati
[✓] Countdown Akad target 2026-01-17 08:00 WIB (UTC+7)
[✓] Maps + Copy Address + Toast elegan (tanpa console error)
[✓] RSVP + Guestbook localStorage, seed 20 entries + createdAt runtime, newest-first, relative time
[✓] Add to Calendar: generate ICS via Blob download (WIB / Asia-Jakarta)
[✓] Sticky bottom nav pill (Home/Mempelai/Acara/Lokasi/RSVP) smooth scroll, tidak makan tempat
[✓] Zero console error (guarded APIs, safe fallbacks)
-->
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Undangan Pernikahan Reza & Alya</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#07080b;
      --bg1:#0b0d12;
      --panel:rgba(255,255,255,.04);
      --panel2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:#f0eee8;
      --muted:rgba(240,238,232,.72);
      --muted2:rgba(240,238,232,.56);
      --gold:rgba(201,152,70,.92);
      --gold2:rgba(201,152,70,.55);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 22px;
      --maxw: 820px;
      --pad: clamp(18px, 4vw, 28px);
      --sectionPad: clamp(44px, 7vw, 82px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 70% -10%, rgba(201,152,70,.10), transparent 60%),
        radial-gradient(900px 700px at 12% 18%, rgba(255,255,255,.05), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, #07080b);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      letter-spacing:.01em;
      line-height:1.85;
      overflow-x:hidden;
    }

    /* subtle noise texture (no external asset) */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.16;
      background:
        radial-gradient(circle at 15% 25%, rgba(255,255,255,.06), transparent 35%),
        radial-gradient(circle at 78% 65%, rgba(255,255,255,.05), transparent 42%),
        repeating-linear-gradient(0deg, rgba(255,255,255,.018), rgba(255,255,255,.018) 1px, transparent 1px, transparent 3px);
      mix-blend-mode: overlay;
      filter: blur(.2px);
      z-index:0;
    }

    a{color:inherit}
    button,input,select,textarea{font:inherit;color:inherit}
    ::selection{background: rgba(201,152,70,.25)}

    .app{
      position:relative;
      z-index:1;
      min-height:100%;
    }

    .wrap{
      width:100%;
      max-width: var(--maxw);
      margin:0 auto;
      padding: 0 var(--pad);
    }

    .lock-scroll{
      height:100vh;
      overflow:hidden;
      touch-action:none;
    }

    /* Gate overlay */
    .gate{
      position:fixed;
      inset:0;
      z-index:50;
      display:grid;
      place-items:center;
      background:
        radial-gradient(900px 600px at 50% 20%, rgba(201,152,70,.12), transparent 55%),
        linear-gradient(180deg, rgba(4,5,8,.92), rgba(8,10,14,.94));
      backdrop-filter: blur(10px);
    }
    .gate-card{
      width:min(560px, calc(100% - 2*var(--pad)));
      border-radius: 24px;
      background: rgba(255,255,255,.035);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      padding: clamp(22px, 4.2vw, 34px);
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .gate-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(450px 260px at 30% 10%, rgba(201,152,70,.14), transparent 55%),
        radial-gradient(520px 320px at 75% 90%, rgba(255,255,255,.06), transparent 60%);
      opacity:.9;
      pointer-events:none;
      filter: blur(.2px);
    }
    .gate-inner{position:relative}
    .gate-eyebrow{
      font-size:12px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color: var(--muted2);
    }
    .gate-to{
      margin-top:10px;
      font-size:16px;
      color: var(--muted);
    }
    .gate-to strong{
      font-weight:600;
      color: var(--text);
    }
    .gate-names{
      margin:16px 0 6px;
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      letter-spacing:.02em;
      font-size: clamp(34px, 6vw, 52px);
      line-height:1.08;
    }
    .gate-date{
      color: var(--muted);
      font-size:14px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .gate-actions{
      margin-top:22px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
    }
    .btn{
      border:1px solid rgba(201,152,70,.28);
      background: linear-gradient(180deg, rgba(201,152,70,.18), rgba(201,152,70,.08));
      color: var(--text);
      padding: 13px 18px;
      border-radius: 999px;
      cursor:pointer;
      transition: transform .18s ease, border-color .18s ease, background .18s ease, box-shadow .18s ease;
      box-shadow: 0 10px 28px rgba(0,0,0,.32);
      width:min(300px, 100%);
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(201,152,70,.45)}
    .btn:active{transform: translateY(0)}
    .btn-ghost{
      width:min(300px, 100%);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }
    .btn-ghost:hover{border-color: rgba(255,255,255,.18); color: var(--text)}
    .gate-hint{
      margin-top:6px;
      font-size:12px;
      color: rgba(240,238,232,.55);
    }

    /* Global floating utilities */
    .top-badge{
      position:fixed;
      top:14px;
      left:50%;
      transform:translateX(-50%);
      z-index:20;
      display:flex;
      gap:10px;
      align-items:center;
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,12,16,.56);
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 40px rgba(0,0,0,.40);
      opacity:0;
      pointer-events:none;
      transition: opacity .35s ease, transform .35s ease;
    }
    body.is-open .top-badge{
      opacity:1;
      pointer-events:auto;
      transform:translateX(-50%) translateY(0);
    }
    .top-badge span{
      font-size:12px;
      color: var(--muted);
      letter-spacing:.04em;
      white-space:nowrap;
    }
    .dot{
      width:5px;height:5px;border-radius:99px;
      background: var(--gold2);
      opacity:.85;
    }

    /* Audio control */
    .audio-btn{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      width:40px;height:40px;
      border-radius:999px;
      display:grid;
      place-items:center;
      cursor:pointer;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
    }
    .audio-btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.16)}
    .audio-btn:active{transform: translateY(0)}
    .audio-btn[disabled]{opacity:.5; cursor:not-allowed}
    .audio-ico{width:18px;height:18px;display:block}
    .audio-ico path{stroke: rgba(240,238,232,.86)}
    .audio-ico .gold{stroke: rgba(201,152,70,.92)}
    .audio-state{
      font-size:12px;
      color: rgba(240,238,232,.66);
      letter-spacing:.02em;
    }

    /* Photo panel (moved into section slots) */
    .photo-slot{
      position:relative;
      margin: 0 0 22px;
    }
    .photo-panel{
      position:relative;
      width:100%;
      border-radius: var(--radius2);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.02);
      box-shadow: 0 18px 55px rgba(0,0,0,.42);
      isolation:isolate;
    }
    .photo-panel.is-hero{border-radius: 26px}
    .photo-panel .layers{
      position:relative;
      width:100%;
      aspect-ratio: 16 / 10;
      min-height: 260px;
    }
    .photo-panel.is-hero .layers{
      aspect-ratio: 4 / 5;
      min-height: 520px;
    }
    @media (max-width:520px){
      .photo-panel.is-hero .layers{min-height: 470px}
    }
    .layer-img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      transform: scale(1.03);
      filter: blur(10px) saturate(.95) brightness(.85);
      opacity:0;
      transition:
        opacity .72s ease,
        transform .90s ease,
        filter .90s ease;
      will-change: opacity, transform, filter;
    }
    .layer-img.is-live{
      opacity:1;
      transform: scale(1.01);
      filter: blur(0px) saturate(1) brightness(.96);
    }

    .photo-panel::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(900px 420px at 50% 10%, rgba(0,0,0,.06), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.56) 62%, rgba(0,0,0,.76));
      z-index:2;
      pointer-events:none;
    }
    .photo-caption{
      position:absolute;
      inset:auto 0 0 0;
      z-index:3;
      padding: 18px 18px 16px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .cap-eyebrow{
      display:flex;
      gap:10px;
      align-items:center;
      font-size:12px;
      letter-spacing:.26em;
      text-transform:uppercase;
      color: rgba(240,238,232,.60);
    }
    .cap-title{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      font-size: clamp(22px, 3.2vw, 30px);
      letter-spacing:.02em;
      line-height:1.15;
      margin:0;
    }
    .cap-sub{
      margin:0;
      color: rgba(240,238,232,.74);
      font-size:13px;
      letter-spacing:.04em;
    }

    /* Sections */
    section{
      padding: var(--sectionPad) 0;
    }
    section:first-of-type{padding-top: 18px}
    .section-inner{
      background: linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.09);
      border-radius: var(--radius2);
      padding: clamp(18px, 3.8vw, 28px);
      box-shadow: 0 18px 48px rgba(0,0,0,.28);
    }
    .section-title{
      font-size:12px;
      letter-spacing:.28em;
      text-transform:uppercase;
      color: rgba(240,238,232,.62);
      margin: 0 0 10px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .section-title::after{
      content:"";
      height:1px;
      flex:1;
      background: linear-gradient(90deg, rgba(201,152,70,.35), rgba(255,255,255,.10), transparent);
      opacity:.85;
    }

    .headline{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      font-size: clamp(34px, 7vw, 58px);
      line-height:1.02;
      letter-spacing:.02em;
      margin: 0 0 12px;
      text-align:center;
    }
    .subline{
      text-align:center;
      color: rgba(240,238,232,.74);
      margin: 0 0 18px;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:12.5px;
    }
    .center{ text-align:center }
    .lead{
      color: rgba(240,238,232,.78);
      margin: 0;
      font-size: 15.5px;
    }
    .muted{ color: rgba(240,238,232,.70) }
    .fine{ color: rgba(240,238,232,.58); font-size: 13.5px }

    .cta-row{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      margin-top: 18px;
    }

    /* Portrait mini frames (stacked, 1 column) */
    .portrait-stack{
      display:flex;
      flex-direction:column;
      gap:14px;
      margin-top: 18px;
    }
    .portrait{
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .portrait img{
      width:100%;
      height:auto;
      display:block;
      transform: scale(1.01);
    }
    .portrait .p-cap{
      padding: 14px 16px 16px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.20);
    }
    .p-name{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      letter-spacing:.02em;
      margin:0 0 2px;
      font-size: 22px;
    }
    .p-role{
      margin:0;
      color: rgba(240,238,232,.66);
      letter-spacing:.16em;
      text-transform:uppercase;
      font-size: 11.5px;
    }

    /* Event blocks */
    .event-grid{
      display:flex;
      flex-direction:column;
      gap:14px;
      margin-top: 14px;
    }
    .event{
      background: rgba(255,255,255,.035);
      border:1px solid rgba(255,255,255,.09);
      border-radius: 18px;
      padding: 16px 16px 16px;
    }
    .event h3{
      margin:0 0 4px;
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      letter-spacing:.02em;
      font-size: 22px;
      line-height:1.12;
    }
    .event .meta{
      margin:0;
      color: rgba(240,238,232,.72);
      font-size: 14px;
      letter-spacing:.02em;
    }

    /* Countdown */
    .countdown{
      margin-top: 16px;
      padding: 14px 14px 16px;
      border-radius: 18px;
      border:1px solid rgba(201,152,70,.22);
      background: linear-gradient(180deg, rgba(201,152,70,.10), rgba(255,255,255,.02));
    }
    .cd-title{
      font-size:12px;
      letter-spacing:.26em;
      text-transform:uppercase;
      color: rgba(240,238,232,.62);
      margin: 0 0 10px;
    }
    .cd-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .cd-box{
      flex:1 1 84px;
      min-width: 84px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      padding: 10px 10px 12px;
      text-align:center;
    }
    .cd-num{
      font-family:"Cormorant Garamond", serif;
      font-weight:600;
      font-size: 28px;
      line-height:1.05;
      margin: 0;
      letter-spacing:.02em;
    }
    .cd-lbl{
      margin: 2px 0 0;
      color: rgba(240,238,232,.64);
      font-size: 12px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }

    /* Action buttons group */
    .actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 14px;
    }
    .btn-inline{
      width:100%;
      border-radius: 16px;
      padding: 12px 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      text-decoration:none;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      color: rgba(240,238,232,.88);
    }
    .btn-inline:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18)}
    .btn-inline:active{transform: translateY(0)}
    .btn-inline.gold{
      border-color: rgba(201,152,70,.28);
      background: linear-gradient(180deg, rgba(201,152,70,.14), rgba(201,152,70,.06));
    }

    /* RSVP form */
    form{
      margin-top: 10px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:7px;
    }
    label{
      font-size:12px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color: rgba(240,238,232,.60);
    }
    input,select,textarea{
      width:100%;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
      padding: 12px 12px;
      outline:none;
      color: rgba(240,238,232,.90);
      transition: border-color .18s ease, background .18s ease;
    }
    textarea{min-height: 120px; resize: vertical}
    input:focus,select:focus,textarea:focus{
      border-color: rgba(201,152,70,.30);
      background: rgba(0,0,0,.24);
    }

    .form-actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 4px;
    }

    /* Guestbook list */
    .gb{
      margin-top: 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .entry{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.09);
      background: rgba(255,255,255,.03);
      padding: 14px 14px 14px;
    }
    .entry-head{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom: 8px;
    }
    .entry-name{
      font-weight:600;
      letter-spacing:.02em;
    }
    .entry-meta{
      color: rgba(240,238,232,.62);
      font-size: 13px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 4px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.20);
    }
    .chip .c-dot{
      width:6px;height:6px;border-radius:99px;
      background: rgba(201,152,70,.68);
      opacity:.9;
    }
    .entry-msg{
      margin:0;
      color: rgba(240,238,232,.82);
    }

    /* Filigree separator */
    .filigree{
      display:grid;
      place-items:center;
      margin: 0 auto;
      padding: 10px 0;
      opacity:0;
      transform: translateY(10px);
      filter: blur(6px);
      transition: opacity .75s ease, transform .75s ease, filter .75s ease;
      will-change: opacity, transform, filter;
    }
    .filigree.is-visible{
      opacity:1;
      transform: translateY(0);
      filter: blur(0px);
    }
    .filigree svg{
      width:min(360px, 78vw);
      height:auto;
      display:block;
    }
    .filigree path{
      stroke: rgba(201,152,70,.55);
      stroke-width: 1.15;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity:.95;
    }
    .filigree .soft{
      stroke: rgba(240,238,232,.16);
      stroke-width: .9;
      opacity:.9;
    }

    /* Bottom nav */
    .nav{
      position:fixed;
      left:50%;
      bottom: 14px;
      transform: translateX(-50%);
      z-index:25;
      display:flex;
      gap:8px;
      padding: 10px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,12,16,.58);
      backdrop-filter: blur(12px);
      box-shadow: 0 18px 50px rgba(0,0,0,.50);
      opacity:0;
      pointer-events:none;
      transition: opacity .35s ease, transform .35s ease;
      max-width: calc(100% - 22px);
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    body.is-open .nav{
      opacity:1;
      pointer-events:auto;
      transform: translateX(-50%) translateY(0);
    }
    .nav a{
      text-decoration:none;
      color: rgba(240,238,232,.72);
      font-size: 12px;
      letter-spacing:.06em;
      padding: 8px 12px;
      border-radius: 999px;
      border:1px solid transparent;
      white-space:nowrap;
      transition: background .18s ease, border-color .18s ease, color .18s ease;
    }
    .nav a:hover{
      color: rgba(240,238,232,.90);
      border-color: rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .nav a.is-active{
      color: rgba(240,238,232,.92);
      border-color: rgba(201,152,70,.28);
      background: rgba(201,152,70,.10);
    }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom: 86px;
      transform: translateX(-50%) translateY(10px);
      z-index:40;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,12,16,.68);
      backdrop-filter: blur(12px);
      color: rgba(240,238,232,.88);
      font-size: 13px;
      letter-spacing:.02em;
      opacity:0;
      pointer-events:none;
      transition: opacity .22s ease, transform .22s ease;
      box-shadow: 0 18px 55px rgba(0,0,0,.55);
      max-width: calc(100% - 22px);
      text-align:center;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      html:focus-within{scroll-behavior:auto}
      *, *::before, *::after{
        animation-duration: 0.001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.001ms !important;
        scroll-behavior: auto !important;
      }
      .filigree{opacity:1; transform:none; filter:none}
      .layer-img{transition-duration: 0.001ms !important}
    }
  </style>
</head>

<body class="lock-scroll">
  <div class="app">
    <!-- Gate overlay -->
    <div class="gate" id="gate" aria-modal="true" role="dialog" aria-label="Pembuka Undangan">
      <div class="gate-card">
        <div class="gate-inner">
          <div class="gate-eyebrow">Undangan Pernikahan</div>
          <div class="gate-to">Kepada Yth. <strong id="guestNameGate">Dimas Budi Ramadhan</strong></div>
          <div class="gate-names">Reza<br/>Alya</div>
          <div class="gate-date">17 Januari 2026 • Le Dian Hotel Serang</div>

          <div class="gate-actions">
            <button class="btn" id="openInviteBtn" type="button" aria-label="Buka Undangan">Buka Undangan</button>
            <button class="btn btn-ghost" id="openNoMusicBtn" type="button" aria-label="Buka tanpa musik">Buka tanpa musik</button>
          </div>
          <div class="gate-hint">Undangan ini dipersonalisasi untuk Anda.</div>
        </div>
      </div>
    </div>

    <!-- Subtle top badge (optional after open) -->
    <div class="top-badge" id="topBadge" aria-live="polite">
      <span id="guestNameSmall">Kepada Yth. Dimas Budi Ramadhan</span>
      <span class="dot" aria-hidden="true"></span>
      <button class="audio-btn" id="audioToggle" type="button" aria-label="Kontrol Musik" disabled>
        <svg class="audio-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path class="gold" d="M11 5 7 8H4v8h3l4 3V5Z" stroke-width="1.8"/>
          <path id="wave1" d="M15.5 9.5c1.2 1.6 1.2 3.4 0 5" stroke-width="1.8" stroke-linecap="round"/>
          <path id="wave2" d="M18 8c2 2.7 2 5.3 0 8" stroke-width="1.8" stroke-linecap="round"/>
          <path id="muteX" d="M16 10l6 6M22 10l-6 6" stroke-width="1.8" stroke-linecap="round" style="display:none"/>
        </svg>
      </button>
      <span class="audio-state" id="audioState">OFF</span>
    </div>

    <!-- Audio -->
    <audio id="bgm" preload="none"></audio>

    <main class="wrap" id="appRoot">
      <!-- Global photo panel (teleported into slots) -->
      <div id="photoPanel" class="photo-panel is-hero" aria-hidden="true">
        <div class="layers">
          <img id="imgA" class="layer-img" alt="" />
          <img id="imgB" class="layer-img" alt="" />
        </div>
        <div class="photo-caption">
          <div class="cap-eyebrow"><span class="dot" aria-hidden="true"></span><span id="capEyebrow">Cover</span></div>
          <h2 class="cap-title" id="capTitle">Reza & Alya</h2>
          <p class="cap-sub" id="capSub">17 Januari 2026 • Le Dian Hotel Serang</p>
        </div>
      </div>

      <!-- 1) COVER / HERO -->
      <section id="home" aria-label="Cover">
        <div class="photo-slot" data-slot="mount" data-photo="hero" data-eyebrow="Cover" data-title="Reza &amp; Alya" data-sub="17 Januari 2026 • Le Dian Hotel Serang"></div>

        <div class="section-inner">
          <p class="section-title">Undangan</p>
          <h1 class="headline">Reza Budi Prasetyo<br/>Alya Putri Maharani</h1>
          <p class="subline">17 Januari 2026</p>
          <p class="lead center muted">
            Dengan segala hormat, kami mengundang Bapak/Ibu/Saudara/i untuk hadir dan memberikan doa terbaik.
          </p>

          <div class="cta-row">
            <button class="btn" id="heroOpenBtn" type="button">Buka Undangan</button>
            <p class="fine center" style="margin:0">Lokasi: Le Dian Hotel Serang</p>
          </div>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 15c-12 12-12 28 0 40c12-12 12-28 0-40Z"/>
          <path d="M260 35c-30 0-42-10-58-22c10 26 26 38 58 44"/>
          <path d="M260 35c30 0 42-10 58-22c-10 26-26 38-58 44"/>
        </svg>
      </div>

      <!-- 2) PEMBUKA -->
      <section id="pembuka" aria-label="Pembuka">
        <div class="photo-slot" data-slot="mount" data-photo="opening" data-eyebrow="Pembuka" data-title="Assalamu’alaikum" data-sub="Warahmatullahi Wabarakatuh"></div>

        <div class="section-inner">
          <p class="section-title">Pembuka</p>
          <p class="lead" style="margin:0 0 10px">
            Assalamu’alaikum Warahmatullahi Wabarakatuh
          </p>
          <p class="muted" style="margin:0">
            Dengan memohon rahmat dan ridha Allah SWT, kami bermaksud menyelenggarakan pernikahan.
            Doa dan kehadiran Anda akan menjadi kehormatan serta kebahagiaan bagi kami.
          </p>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 18c0 0-16 8-16 17s16 17 16 17s16-8 16-17s-16-17-16-17Z"/>
          <path d="M244 35c-24 0-36-7-54-18c9 22 24 34 54 38"/>
          <path d="M276 35c24 0 36-7 54-18c-9 22-24 34-54 38"/>
        </svg>
      </div>

      <!-- 3) MEMPELAI -->
      <section id="mempelai" aria-label="Mempelai">
        <div class="photo-slot" data-slot="mount" data-photo="couple" data-eyebrow="Mempelai" data-title="Reza &amp; Alya" data-sub="Dengan cinta, doa, dan harapan terbaik."></div>

        <div class="section-inner">
          <p class="section-title">Mempelai</p>
          <p class="muted" style="margin:0">
            Kami memulai babak baru dengan hati yang tenang dan niat yang baik.
            Semoga langkah ini menjadi jalan yang penuh berkah.
          </p>

          <div class="portrait-stack" aria-label="Profil Mempelai">
            <div class="portrait">
              <img id="imgGroom" alt="Reza Budi Prasetyo" />
              <div class="p-cap">
                <p class="p-name">Reza Budi Prasetyo</p>
                <p class="p-role">Mempelai Pria</p>
              </div>
            </div>

            <div class="portrait">
              <img id="imgBride" alt="Alya Putri Maharani" />
              <div class="p-cap">
                <p class="p-name">Alya Putri Maharani</p>
                <p class="p-role">Mempelai Wanita</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 14c-10 9-14 18-14 21c0 10 14 23 14 23s14-13 14-23c0-3-4-12-14-21Z"/>
          <path d="M260 35c-34 0-48-11-66-26c11 30 30 46 66 52"/>
          <path d="M260 35c34 0 48-11 66-26c-11 30-30 46-66 52"/>
        </svg>
      </div>

      <!-- 4) ACARA -->
      <section id="acara" aria-label="Acara">
        <div class="photo-slot" data-slot="mount" data-photo="akad" data-eyebrow="Acara" data-title="17 Januari 2026" data-sub="Akad Nikah &amp; Resepsi"></div>

        <div class="section-inner">
          <p class="section-title">Acara</p>

          <div class="event-grid" aria-label="Rangkaian Acara">
            <div class="event" id="blokAkad">
              <h3>Akad Nikah</h3>
              <p class="meta">17 Januari 2026 — 08.00–09.00 WIB</p>
            </div>

            <!-- Trigger for photo swap inside ACARA -->
            <div aria-hidden="true" data-photo-trigger="resepsi" style="height:1px;"></div>

            <div class="event" id="blokResepsi">
              <h3>Resepsi</h3>
              <p class="meta">17 Januari 2026 — 10.00–15.00 WIB</p>
            </div>
          </div>

          <div class="countdown" aria-label="Countdown">
            <p class="cd-title">Countdown menuju Akad</p>
            <div class="cd-row" role="group" aria-label="Sisa waktu">
              <div class="cd-box">
                <p class="cd-num" id="cdDays">—</p>
                <p class="cd-lbl">Hari</p>
              </div>
              <div class="cd-box">
                <p class="cd-num" id="cdHours">—</p>
                <p class="cd-lbl">Jam</p>
              </div>
              <div class="cd-box">
                <p class="cd-num" id="cdMins">—</p>
                <p class="cd-lbl">Menit</p>
              </div>
              <div class="cd-box">
                <p class="cd-num" id="cdSecs">—</p>
                <p class="cd-lbl">Detik</p>
              </div>
            </div>
          </div>

          <div class="actions" aria-label="Aksi Lokasi">
            <a class="btn-inline gold" id="mapsBtn" href="https://maps.app.goo.gl/oJVfShW7g5PJV2cS8" target="_blank" rel="noopener">Buka Google Maps</a>
            <button class="btn-inline" id="copyAddrBtn" type="button">Salin Alamat</button>
          </div>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 20c-8 6-12 12-12 16c0 9 12 18 12 18s12-9 12-18c0-4-4-10-12-16Z"/>
          <path d="M248 36c-20 0-30-6-44-14c8 18 20 27 44 30"/>
          <path d="M272 36c20 0 30-6 44-14c-8 18-20 27-44 30"/>
        </svg>
      </div>

      <!-- 5) LOKASI -->
      <section id="lokasi" aria-label="Lokasi">
        <div class="photo-slot" data-slot="mount" data-photo="venue" data-eyebrow="Lokasi" data-title="Le Dian Hotel Serang" data-sub="Klik peta untuk rute terbaik."></div>

        <div class="section-inner">
          <p class="section-title">Lokasi</p>
          <p class="lead" style="margin:0 0 6px">Le Dian Hotel Serang</p>
          <p class="muted" style="margin:0 0 14px">
            Kami menantikan kehadiran Anda di lokasi acara.
          </p>

          <div class="actions">
            <a class="btn-inline gold" href="https://maps.app.goo.gl/oJVfShW7g5PJV2cS8" target="_blank" rel="noopener">Buka Google Maps</a>
            <button class="btn-inline" id="copyAddrBtn2" type="button">Salin Alamat</button>
          </div>
          <p class="fine" style="margin:12px 0 0">Micro info: Le Dian Hotel Serang</p>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 15c-12 8-18 16-18 20c0 11 18 25 18 25s18-14 18-25c0-4-6-12-18-20Z"/>
          <path d="M232 33c12 10 20 14 28 14"/>
          <path d="M288 33c-12 10-20 14-28 14"/>
        </svg>
      </div>

      <!-- 6) RSVP + BUKU TAMU -->
      <section id="rsvp" aria-label="RSVP dan Buku Tamu">
        <div class="photo-slot" data-slot="mount" data-photo="rsvp" data-eyebrow="RSVP" data-title="Konfirmasi Kehadiran" data-sub="Terima kasih atas doa dan perhatian Anda."></div>

        <div class="section-inner">
          <p class="section-title">RSVP &amp; Buku Tamu</p>

          <form id="rsvpForm" autocomplete="off" novalidate>
            <div class="field">
              <label for="nama">Nama</label>
              <input id="nama" name="nama" type="text" inputmode="text" maxlength="60" required />
            </div>

            <div class="field">
              <label for="hadir">Kehadiran</label>
              <select id="hadir" name="hadir" required>
                <option value="Hadir">Hadir</option>
                <option value="Tidak">Tidak</option>
              </select>
            </div>

            <div class="field">
              <label for="tamu">Jumlah Tamu</label>
              <select id="tamu" name="tamu" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>

            <div class="field">
              <label for="ucapan">Ucapan</label>
              <textarea id="ucapan" name="ucapan" maxlength="240" required></textarea>
            </div>

            <div class="form-actions">
              <button class="btn" type="submit">Kirim RSVP</button>
              <button class="btn btn-ghost" id="resetGuestbookBtn" type="button">Reset Data</button>
            </div>
          </form>

          <div class="gb" id="guestbookList" aria-label="Daftar Ucapan"></div>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 22c-20 0-28 11-28 17c0 12 28 25 28 25s28-13 28-25c0-6-8-17-28-17Z"/>
          <path d="M240 41c8 10 14 14 20 14"/>
          <path d="M280 41c-8 10-14 14-20 14"/>
        </svg>
      </div>

      <!-- 7) ADD TO CALENDAR (ICS) -->
      <section id="calendar" aria-label="Add to Calendar">
        <div class="photo-slot" data-slot="mount" data-photo="venue" data-eyebrow="Kalender" data-title="Tambahkan ke Kalender" data-sub="Agar tidak terlewat."></div>

        <div class="section-inner">
          <p class="section-title">Add to Calendar</p>
          <p class="muted" style="margin:0 0 14px">
            Simpan jadwal Akad dan Resepsi ke kalender Anda.
          </p>

          <div class="actions">
            <button class="btn-inline gold" id="icsAkadBtn" type="button">Tambahkan Akad ke Kalender</button>
            <button class="btn-inline" id="icsResepsiBtn" type="button">Tambahkan Resepsi ke Kalender</button>
          </div>

          <p class="fine" style="margin:12px 0 0">
            Timezone: Asia/Jakarta (WIB)
          </p>
        </div>
      </section>

      <div class="filigree" aria-hidden="true">
        <svg viewBox="0 0 520 70">
          <path class="soft" d="M20 35h160"/>
          <path class="soft" d="M340 35h160"/>
          <path d="M260 16c-14 10-20 18-20 22c0 12 20 26 20 26s20-14 20-26c0-4-6-12-20-22Z"/>
          <path d="M260 36c-14 0-22-4-36-12c6 16 16 24 36 26"/>
          <path d="M260 36c14 0 22-4 36-12c-6 16-16 24-36 26"/>
        </svg>
      </div>

      <!-- 8) FOOTER -->
      <section id="footer" aria-label="Penutup" style="padding-bottom: 120px;">
        <div class="photo-slot" data-slot="mount" data-photo="hero" data-eyebrow="Penutup" data-title="Terima Kasih" data-sub="Sampai bertemu di hari bahagia."></div>

        <div class="section-inner">
          <p class="section-title">Penutup</p>
          <p class="muted" style="margin:0 0 12px">
            Terima kasih atas perhatian, doa, dan kehadiran Anda. Semoga kebaikan selalu menyertai kita semua.
          </p>

          <div class="actions">
            <button class="btn-inline gold" id="backToTopBtn" type="button">Kembali ke Atas</button>
          </div>
          <p class="fine" style="margin:12px 0 0">Reza Budi Prasetyo • Alya Putri Maharani</p>
        </div>
      </section>
    </main>

    <!-- Bottom nav -->
    <nav class="nav" id="nav" aria-label="Navigasi">
      <a href="#home" data-nav="home">Home</a>
      <a href="#mempelai" data-nav="mempelai">Mempelai</a>
      <a href="#acara" data-nav="acara">Acara</a>
      <a href="#lokasi" data-nav="lokasi">Lokasi</a>
      <a href="#rsvp" data-nav="rsvp">RSVP</a>
    </nav>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>
  </div>

  <script>
  (function(){
    'use strict';

    const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // Assets mapping (EXACT)
    const photos = {
      hero: "assets/img/reza-alya.png",
      opening: "assets/img/reza-alya.2.png",
      couple: "assets/img/reza-alya.3.png",
      akad: "assets/img/reza-alya.4.png",
      resepsi: "assets/img/reza-alya.5.png",
      venue: "assets/img/reza-alya.6.png",
      groom: "assets/img/reza.png",
      bride: "assets/img/alya.png",
      rsvp: "assets/img/hand.png"
    };

    const audioSrc = "assets/audio/Wedding%20Invitation%20Jason%20Farnham%20(No%20Copyright%20Music).mp3";

    // Fixed guest name
    const guestName = "Dimas Budi Ramadhan";

    // DOM
    const body = document.body;
    const gate = document.getElementById('gate');
    const openInviteBtn = document.getElementById('openInviteBtn');
    const openNoMusicBtn = document.getElementById('openNoMusicBtn');
    const heroOpenBtn = document.getElementById('heroOpenBtn');

    const guestNameGate = document.getElementById('guestNameGate');
    const guestNameSmall = document.getElementById('guestNameSmall');

    const bgm = document.getElementById('bgm');
    const audioToggle = document.getElementById('audioToggle');
    const audioState = document.getElementById('audioState');

    const photoPanel = document.getElementById('photoPanel');
    const imgA = document.getElementById('imgA');
    const imgB = document.getElementById('imgB');
    const capEyebrow = document.getElementById('capEyebrow');
    const capTitle = document.getElementById('capTitle');
    const capSub = document.getElementById('capSub');

    const imgGroom = document.getElementById('imgGroom');
    const imgBride = document.getElementById('imgBride');

    const copyAddrBtn = document.getElementById('copyAddrBtn');
    const copyAddrBtn2 = document.getElementById('copyAddrBtn2');

    const cdDays = document.getElementById('cdDays');
    const cdHours = document.getElementById('cdHours');
    const cdMins = document.getElementById('cdMins');
    const cdSecs = document.getElementById('cdSecs');

    const toast = document.getElementById('toast');

    const rsvpForm = document.getElementById('rsvpForm');
    const guestbookList = document.getElementById('guestbookList');
    const resetGuestbookBtn = document.getElementById('resetGuestbookBtn');

    const icsAkadBtn = document.getElementById('icsAkadBtn');
    const icsResepsiBtn = document.getElementById('icsResepsiBtn');

    const backToTopBtn = document.getElementById('backToTopBtn');
    const nav = document.getElementById('nav');

    // Safe helpers
    function $(sel, root=document){ return root.querySelector(sel); }
    function $all(sel, root=document){ return Array.from(root.querySelectorAll(sel)); }

    function showToast(msg){
      if(!toast) return;
      toast.textContent = msg;
      toast.classList.add('show');
      window.clearTimeout(showToast._t);
      showToast._t = window.setTimeout(()=>toast.classList.remove('show'), 2200);
    }

    // Gate personalization
    if(guestNameGate) guestNameGate.textContent = guestName;
    if(guestNameSmall) guestNameSmall.textContent = "Kepada Yth. " + guestName;

    // Set portrait sources
    if(imgGroom) imgGroom.src = photos.groom;
    if(imgBride) imgBride.src = photos.bride;

    // Audio setup
    let isOpen = false;
    let isPlaying = false;
    function setAudioUI(){
      if(!audioState || !audioToggle) return;
      audioState.textContent = isPlaying ? "ON" : "OFF";
      const wave1 = document.getElementById('wave1');
      const wave2 = document.getElementById('wave2');
      const muteX = document.getElementById('muteX');
      if(wave1 && wave2 && muteX){
        if(isPlaying){
          wave1.style.display = '';
          wave2.style.display = '';
          muteX.style.display = 'none';
        }else{
          wave1.style.display = 'none';
          wave2.style.display = 'none';
          muteX.style.display = '';
        }
      }
      audioToggle.setAttribute('aria-label', isPlaying ? 'Matikan Musik' : 'Nyalakan Musik');
    }

    function tryPlay(){
      if(!bgm) return;
      const p = bgm.play();
      if(p && typeof p.then === 'function'){
        p.then(()=> {
          isPlaying = true;
          setAudioUI();
        }).catch(()=> {
          isPlaying = false;
          setAudioUI();
          // keep silent; user can toggle again
        });
      }else{
        isPlaying = true;
        setAudioUI();
      }
    }

    function stopAudio(){
      if(!bgm) return;
      try{ bgm.pause(); }catch(e){}
      isPlaying = false;
      setAudioUI();
    }

    function toggleAudio(){
      if(!isOpen) return;
      if(!bgm) return;
      if(isPlaying){
        stopAudio();
      }else{
        tryPlay();
      }
    }

    if(bgm){
      bgm.src = audioSrc;
      bgm.loop = true;
      bgm.preload = "none";
      bgm.volume = 0.55;
    }
    setAudioUI();

    if(audioToggle){
      audioToggle.addEventListener('click', function(){
        toggleAudio();
      });
    }

    function openInvite(withMusic){
      if(isOpen) return;
      isOpen = true;

      // unlock scroll
      body.classList.remove('lock-scroll');
      body.classList.add('is-open');

      // close gate
      if(gate){
        gate.style.display = 'none';
        gate.setAttribute('aria-hidden','true');
      }

      // enable audio toggle
      if(audioToggle) audioToggle.disabled = false;

      // Start music only after user interaction (this click)
      if(withMusic){
        tryPlay();
      }else{
        stopAudio();
      }

      // slight nudge to ensure layout settled
      window.setTimeout(()=> {
        // no-op; avoids some mobile glitches without logging
      }, 0);
    }

    if(openInviteBtn){
      openInviteBtn.addEventListener('click', function(){
        openInvite(true);
      });
    }
    if(openNoMusicBtn){
      openNoMusicBtn.addEventListener('click', function(){
        openInvite(false);
      });
    }
    if(heroOpenBtn){
      heroOpenBtn.addEventListener('click', function(){
        if(!isOpen){
          // if gate still present, do nothing visible; gate already blocks.
          return;
        }
        const target = document.getElementById('pembuka');
        if(target){
          target.scrollIntoView({behavior: prefersReducedMotion ? 'auto' : 'smooth', block:'start'});
        }
      });
    }

    // Photo panel crossfade (two layers)
    let activeLayer = 'A';
    let currentKey = null;

    function setPanelHero(isHero){
      if(!photoPanel) return;
      if(isHero) photoPanel.classList.add('is-hero');
      else photoPanel.classList.remove('is-hero');
    }

    function setCaption(eyebrow, title, sub){
      if(capEyebrow) capEyebrow.textContent = eyebrow || '';
      if(capTitle) capTitle.textContent = title || '';
      if(capSub) capSub.textContent = sub || '';
    }

    function swapPhoto(key, eyebrow, title, sub, isHero){
      if(!photoPanel || !imgA || !imgB) return;
      if(!photos[key]) return;

      if(currentKey === key){
        // still update caption/hero shape if needed
        setCaption(eyebrow, title, sub);
        setPanelHero(!!isHero);
        return;
      }

      setCaption(eyebrow, title, sub);
      setPanelHero(!!isHero);

      const nextSrc = photos[key];
      const nextImg = (activeLayer === 'A') ? imgB : imgA;
      const liveImg = (activeLayer === 'A') ? imgA : imgB;

      // Ensure transitions are subtle; if reduced motion, snap
      nextImg.classList.remove('is-live');
      nextImg.src = nextSrc;

      const onReady = () => {
        // crossfade
        if(prefersReducedMotion){
          liveImg.classList.remove('is-live');
          nextImg.classList.add('is-live');
        }else{
          // force style recalculation
          void nextImg.offsetWidth;
          liveImg.classList.remove('is-live');
          nextImg.classList.add('is-live');
        }
        activeLayer = (activeLayer === 'A') ? 'B' : 'A';
        currentKey = key;
        nextImg.removeEventListener('load', onReady);
      };

      if(nextImg.complete && nextImg.naturalWidth > 0){
        onReady();
      }else{
        nextImg.addEventListener('load', onReady, {once:true});
      }
    }

    // Preload minimal set
    function preload(keys){
      keys.forEach(k=>{
        if(!photos[k]) return;
        const im = new Image();
        im.decoding = 'async';
        im.src = photos[k];
      });
    }
    preload(['hero','opening','couple','akad','resepsi']);

    // Initialize panel with hero to avoid empty flash
    (function initPanel(){
      imgA.src = photos.hero;
      imgA.classList.add('is-live');
      currentKey = 'hero';
      setCaption('Cover', 'Reza & Alya', '17 Januari 2026 • Le Dian Hotel Serang');
      setPanelHero(true);
    })();

    // Teleport photo panel into section slots + update on triggers
    const slots = $all('.photo-slot');
    const triggers = $all('[data-photo-trigger]');
    function mountPanelInto(el){
      if(!el || !photoPanel) return;
      el.appendChild(photoPanel);
    }

    // observe slots
    if('IntersectionObserver' in window){
      const slotObs = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(!entry.isIntersecting) return;
          const el = entry.target;
          const key = el.getAttribute('data-photo');
          const eyebrow = el.getAttribute('data-eyebrow') || '';
          const title = el.getAttribute('data-title') || '';
          const sub = el.getAttribute('data-sub') || '';
          const isHero = key === 'hero' && (el.closest('#home') != null);

          // mount panel into this slot
          mountPanelInto(el);

          // swap image
          swapPhoto(key, eyebrow, title, sub, isHero);

          // update nav active (rough sync)
          const sec = el.closest('section');
          if(sec && sec.id){
            setActiveNav(sec.id);
          }
        });
      }, {threshold: 0.62});

      slots.forEach(s=> slotObs.observe(s));

      // observe photo triggers (resepsi swap inside acara)
      const trigObs = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(!entry.isIntersecting) return;
          const t = entry.target;
          const key = t.getAttribute('data-photo-trigger');
          if(key === 'resepsi'){
            // keep captions as Acara, swap to resepsi image
            swapPhoto('resepsi', 'Acara', '17 Januari 2026', 'Akad Nikah & Resepsi', false);
          }
        });
      }, {threshold: 0.6});

      triggers.forEach(t=> trigObs.observe(t));
    } else {
      // fallback: mount to first slot only
      if(slots[0]) mountPanelInto(slots[0]);
    }

    // Filigree separators animate on viewport
    const filigrees = $all('.filigree');
    if('IntersectionObserver' in window){
      const fObs = new IntersectionObserver((entries)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            entry.target.classList.add('is-visible');
          }
        });
      }, {threshold: 0.55});
      filigrees.forEach(f=> fObs.observe(f));
      if(prefersReducedMotion){
        filigrees.forEach(f=> f.classList.add('is-visible'));
      }
    } else {
      filigrees.forEach(f=> f.classList.add('is-visible'));
    }

    // Copy address
    const addressText = "Le Dian Hotel Serang";
    async function copyAddress(){
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){
          await navigator.clipboard.writeText(addressText);
          showToast("Alamat disalin.");
        }else{
          // fallback
          const ta = document.createElement('textarea');
          ta.value = addressText;
          ta.setAttribute('readonly','');
          ta.style.position = 'fixed';
          ta.style.opacity = '0';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
          showToast("Alamat disalin.");
        }
      }catch(e){
        showToast("Tidak bisa menyalin.");
      }
    }
    if(copyAddrBtn) copyAddrBtn.addEventListener('click', copyAddress);
    if(copyAddrBtn2) copyAddrBtn2.addEventListener('click', copyAddress);

    // Countdown to Akad (WIB UTC+7) -> 2026-01-17 08:00 WIB == 2026-01-17 01:00 UTC
    const targetUTC = Date.UTC(2026, 0, 17, 1, 0, 0); // Jan=0
    function pad2(n){ return String(n).padStart(2,'0'); }

    function tickCountdown(){
      const now = Date.now();
      let diff = targetUTC - now;

      if(diff <= 0){
        cdDays.textContent = "0";
        cdHours.textContent = "0";
        cdMins.textContent = "0";
        cdSecs.textContent = "0";
        return;
      }
      const sec = Math.floor(diff/1000);
      const days = Math.floor(sec / 86400);
      const hours = Math.floor((sec % 86400) / 3600);
      const mins = Math.floor((sec % 3600) / 60);
      const secs = sec % 60;

      cdDays.textContent = String(days);
      cdHours.textContent = pad2(hours);
      cdMins.textContent = pad2(mins);
      cdSecs.textContent = pad2(secs);
    }
    tickCountdown();
    window.setInterval(tickCountdown, 1000);

    // Guestbook + RSVP (localStorage)
    const STORAGE_KEY = 'ra_guestbook_v1';

    const seedBase = [
      { name:"Dimas Budi Ramadhan", hadir:"Hadir", tamu:2, ucapan:"Selamat menempuh hidup baru Reza & Alya. Semoga jadi keluarga sakinah, mawaddah, warahmah. Lancar sampai hari H." },
      { name:"Raka Pratama", hadir:"Hadir", tamu:1, ucapan:"MasyaAllah, ikut bahagia. Semoga rumah tangganya adem, rezekinya luas, dan selalu saling menguatkan." },
      { name:"Nadia Putri", hadir:"Hadir", tamu:2, ucapan:"Congratulations! Semoga pernikahannya penuh berkah, sehat, dan selalu kompak sampai tua." },
      { name:"Fajar Maulana", hadir:"Hadir", tamu:1, ucapan:"Selamat yaa. Semoga acaranya lancar, tamunya ramai, dan semuanya dimudahkan." },
      { name:"Intan Salsabila", hadir:"Tidak", tamu:1, ucapan:"Maaf belum bisa hadir. Doa terbaik buat kalian berdua, semoga bahagia dan diberkahi selalu." },
      { name:"Yoga Saputra", hadir:"Hadir", tamu:2, ucapan:"Selamat Reza & Alya. Semoga jadi pasangan yang saling melengkapi, saling sabar, dan makin sayang tiap hari." },
      { name:"Rizky Andrian", hadir:"Hadir", tamu:1, ucapan:"Happy wedding! Semoga semua rencana baik kalian dimudahkan, dan rumah tangga selalu hangat." },
      { name:"Siti Rahmah", hadir:"Hadir", tamu:2, ucapan:"Barakallahu lakuma. Semoga menjadi keluarga yang penuh cinta, rahmat, dan ketenangan." },
      { name:"Ahmad Fikri", hadir:"Tidak", tamu:1, ucapan:"Mohon maaf belum bisa datang. Semoga akad dan resepsi berjalan lancar, dan kalian selalu diberi kebahagiaan." },
      { name:"Dewi Lestari", hadir:"Hadir", tamu:1, ucapan:"Seneng banget dengernya. Semoga langgeng, komunikasinya sehat, dan selalu saling menghargai." },
      { name:"Rina Wulandari", hadir:"Hadir", tamu:2, ucapan:"Selamat ya! Semoga jadi tim terbaik seumur hidup, kompak terus, dan diberkahi dalam setiap langkah." },
      { name:"Bayu Kurniawan", hadir:"Hadir", tamu:1, ucapan:"Selamat menempuh babak baru. Semoga bahagia, sehat, dan karier serta rezekinya makin lancar." },
      { name:"Rafi Nurhadi", hadir:"Hadir", tamu:2, ucapan:"InsyaAllah hadir. Semoga acara di Le Dian lancar, cuaca bagus, dan semuanya berjalan sesuai harapan." },
      { name:"Putri Anjani", hadir:"Tidak", tamu:1, ucapan:"Selamat untuk kalian berdua. Titip doa dari jauh semoga rumah tangga kalian selalu diberi berkah." },
      { name:"Agung Prasetyo", hadir:"Hadir", tamu:1, ucapan:"Selamat Reza & Alya. Semoga jadi pasangan yang saling menenangkan, saling dukung, dan langgeng." },
      { name:"Maya Kartika", hadir:"Hadir", tamu:2, ucapan:"Bahagia selalu ya. Semoga hari pernikahannya berkesan, dan setelahnya makin harmonis." },
      { name:"Hendra Gunawan", hadir:"Hadir", tamu:1, ucapan:"Selamat! Semoga pernikahan ini membawa kebaikan, keberkahan, dan kebahagiaan untuk kalian." },
      { name:"Aulia Nurfadillah", hadir:"Hadir", tamu:2, ucapan:"MasyaAllah tabarakallah. Semoga jadi keluarga yang penuh cinta dan selalu dalam lindungan Allah." },
      { name:"Kevin Pradana", hadir:"Hadir", tamu:1, ucapan:"Congrats! Semoga makin solid, makin sayang, dan semua urusan dimudahkan." },
      { name:"Tania Aprillia", hadir:"Hadir", tamu:2, ucapan:"Selamat menempuh hidup baru. Semoga kalian selalu diberikan kesabaran, kelapangan hati, dan kebahagiaan." }
    ];

    function buildSeed(){
      const now = Date.now();
      // offsets (ms) varied: minutes, hours, days
      const offsets = [
        5*60*1000,  28*60*1000,  55*60*1000,  2*60*60*1000,  4*60*60*1000,
        7*60*60*1000,  10*60*60*1000,  14*60*60*1000,  19*60*60*1000,  22*60*60*1000,
        1*24*60*60*1000,  1.6*24*60*60*1000,  2.2*24*60*60*1000,  2.9*24*60*60*1000,  3.4*24*60*60*1000,
        4.1*24*60*60*1000,  4.8*24*60*60*1000,  5.6*24*60*60*1000,  6.2*24*60*60*1000,  7.0*24*60*60*1000
      ];

      return seedBase.map((s, i)=>({
        name: s.name,
        hadir: s.hadir,
        tamu: s.tamu,
        ucapan: s.ucapan,
        createdAt: new Date(now - Math.floor(offsets[i] || (i+1)*3600000)).toISOString()
      }));
    }

    function loadGuestbook(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          const seeded = buildSeed();
          localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
          return seeded;
        }
        const parsed = JSON.parse(raw);
        if(!Array.isArray(parsed) || parsed.length === 0){
          const seeded = buildSeed();
          localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
          return seeded;
        }
        return parsed;
      }catch(e){
        // fallback: seed in-memory
        return buildSeed();
      }
    }

    function saveGuestbook(items){
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      }catch(e){
        // ignore
      }
    }

    function relativeTime(iso){
      const t = new Date(iso).getTime();
      if(!isFinite(t)) return "baru saja";
      const diff = Date.now() - t;
      const sec = Math.floor(diff/1000);
      if(sec < 45) return "baru saja";
      const min = Math.floor(sec/60);
      if(min < 60) return min + " menit lalu";
      const hr = Math.floor(min/60);
      if(hr < 24) return hr + " jam lalu";
      const day = Math.floor(hr/24);
      if(day < 7) return day + " hari lalu";
      const wk = Math.floor(day/7);
      if(wk < 5) return wk + " minggu lalu";
      const mo = Math.floor(day/30);
      return mo + " bulan lalu";
    }

    function escapeHTML(str){
      return String(str)
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#39;");
    }

    function renderGuestbook(items){
      if(!guestbookList) return;
      const sorted = items.slice().sort((a,b)=>{
        const ta = new Date(a.createdAt).getTime();
        const tb = new Date(b.createdAt).getTime();
        return (tb||0) - (ta||0);
      });

      guestbookList.innerHTML = sorted.map((it)=>{
        const hadirLabel = it.hadir === "Hadir" ? "Hadir" : "Tidak Hadir";
        return `
          <div class="entry">
            <div class="entry-head">
              <div class="entry-name">${escapeHTML(it.name || "Tamu")}</div>
              <div class="entry-meta">
                <span class="chip"><span class="c-dot"></span>${escapeHTML(hadirLabel)}</span>
                <span class="chip"><span class="c-dot"></span>${escapeHTML(String(it.tamu || 1))} tamu</span>
                <span class="chip"><span class="c-dot"></span>${escapeHTML(relativeTime(it.createdAt))}</span>
              </div>
            </div>
            <p class="entry-msg">${escapeHTML(it.ucapan || "")}</p>
          </div>
        `;
      }).join('');
    }

    let guestbook = loadGuestbook();
    renderGuestbook(guestbook);

    if(rsvpForm){
      rsvpForm.addEventListener('submit', function(e){
        e.preventDefault();

        const nama = (document.getElementById('nama') || {}).value || '';
        const hadir = (document.getElementById('hadir') || {}).value || 'Hadir';
        const tamu = parseInt(((document.getElementById('tamu') || {}).value || '1'), 10);
        const ucapan = (document.getElementById('ucapan') || {}).value || '';

        const nameTrim = nama.trim();
        const msgTrim = ucapan.trim();

        if(!nameTrim || !msgTrim){
          showToast("Lengkapi nama dan ucapan.");
          return;
        }

        const entry = {
          name: nameTrim.slice(0, 60),
          hadir: hadir === "Tidak" ? "Tidak" : "Hadir",
          tamu: (isFinite(tamu) && tamu >= 1 && tamu <= 5) ? tamu : 1,
          ucapan: msgTrim.slice(0, 240),
          createdAt: new Date().toISOString()
        };

        guestbook = [entry].concat(guestbook);
        saveGuestbook(guestbook);
        renderGuestbook(guestbook);
        rsvpForm.reset();
        showToast("Terima kasih. RSVP tersimpan.");
      });
    }

    if(resetGuestbookBtn){
      resetGuestbookBtn.addEventListener('click', function(){
        const ok = window.confirm("Reset data RSVP & buku tamu di perangkat ini?");
        if(!ok) return;
        guestbook = buildSeed();
        saveGuestbook(guestbook);
        renderGuestbook(guestbook);
        showToast("Data direset.");
      });
    }

    // ICS generator (WIB / Asia-Jakarta)
    function uid(){
      return 'ra-' + Math.random().toString(16).slice(2) + '-' + Date.now();
    }
    function dtstampUTC(){
      const d = new Date();
      const z = new Date(d.getTime() - d.getTimezoneOffset()*60000).toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z$/,'Z');
      return z;
    }
    function icsEscape(s){
      return String(s).replace(/\\n/g,'\n').replace(/\n/g,'\\n').replace(/,/g,'\\,').replace(/;/g,'\\;');
    }
    function buildVTimezoneJakarta(){
      // No DST
      return [
        "BEGIN:VTIMEZONE",
        "TZID:Asia/Jakarta",
        "BEGIN:STANDARD",
        "TZOFFSETFROM:+0700",
        "TZOFFSETTO:+0700",
        "TZNAME:WIB",
        "DTSTART:19700101T000000",
        "END:STANDARD",
        "END:VTIMEZONE"
      ].join("\r\n");
    }
    function buildEvent(opts){
      // DTSTART/DTEND in local WIB as TZID:Asia/Jakarta
      return [
        "BEGIN:VEVENT",
        "UID:" + uid(),
        "DTSTAMP:" + dtstampUTC(),
        "SUMMARY:" + icsEscape(opts.summary),
        "DTSTART;TZID=Asia/Jakarta:" + opts.dtstart,
        "DTEND;TZID=Asia/Jakarta:" + opts.dtend,
        "LOCATION:" + icsEscape(opts.location),
        "URL:" + opts.url,
        "DESCRIPTION:" + icsEscape(opts.description),
        "END:VEVENT"
      ].join("\r\n");
    }
    function downloadICS(filename, icsText){
      const blob = new Blob([icsText], {type:'text/calendar;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    function makeCalendar(eventType){
      const location = "Le Dian Hotel Serang";
      const url = "https://maps.app.goo.gl/oJVfShW7g5PJV2cS8";
      const base = [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//RezaAlya//Wedding Invitation//ID",
        "CALSCALE:GREGORIAN",
        "METHOD:PUBLISH",
        buildVTimezoneJakarta()
      ];

      let event;
      if(eventType === 'akad'){
        event = buildEvent({
          summary: "Akad Nikah - Reza & Alya",
          dtstart: "20260117T080000",
          dtend: "20260117T090000",
          location,
          url,
          description: "Akad Nikah Reza Budi Prasetyo & Alya Putri Maharani di Le Dian Hotel Serang."
        });
      }else{
        event = buildEvent({
          summary: "Resepsi - Reza & Alya",
          dtstart: "20260117T100000",
          dtend: "20260117T150000",
          location,
          url,
          description: "Resepsi Reza Budi Prasetyo & Alya Putri Maharani di Le Dian Hotel Serang."
        });
      }

      const tail = ["END:VCALENDAR"];
      const ics = base.concat([event]).concat(tail).join("\r\n");
      return ics;
    }

    if(icsAkadBtn){
      icsAkadBtn.addEventListener('click', function(){
        const ics = makeCalendar('akad');
        downloadICS('Reza-Alya_Akad.ics', ics);
        showToast("ICS Akad diunduh.");
      });
    }
    if(icsResepsiBtn){
      icsResepsiBtn.addEventListener('click', function(){
        const ics = makeCalendar('resepsi');
        downloadICS('Reza-Alya_Resepsi.ics', ics);
        showToast("ICS Resepsi diunduh.");
      });
    }

    // Back to top
    if(backToTopBtn){
      backToTopBtn.addEventListener('click', function(){
        const home = document.getElementById('home');
        if(home){
          home.scrollIntoView({behavior: prefersReducedMotion ? 'auto' : 'smooth', block:'start'});
        }
      });
    }

    // Smooth nav scroll + active state
    function setActiveNav(id){
      if(!nav) return;
      $all('a[data-nav]', nav).forEach(a=>{
        a.classList.toggle('is-active', a.getAttribute('data-nav') === id);
      });
    }

    if(nav){
      nav.addEventListener('click', function(e){
        const a = e.target && e.target.closest && e.target.closest('a[data-nav]');
        if(!a) return;
        e.preventDefault();
        const href = a.getAttribute('href') || '';
        const id = href.startsWith('#') ? href.slice(1) : '';
        const target = id ? document.getElementById(id) : null;
        if(target){
          target.scrollIntoView({behavior: prefersReducedMotion ? 'auto' : 'smooth', block:'start'});
          setActiveNav(id);
        }
      });
    }

    // Observe sections for nav highlight
    const sections = $all('main section');
    if('IntersectionObserver' in window){
      const secObs = new IntersectionObserver((entries)=>{
        // pick the most visible
        let best = null;
        entries.forEach(en=>{
          if(!en.isIntersecting) return;
          if(!best || en.intersectionRatio > best.intersectionRatio) best = en;
        });
        if(best && best.target && best.target.id){
          setActiveNav(best.target.id);
        }
      }, {threshold: [0.25, 0.4, 0.55, 0.7]});
      sections.forEach(s=> secObs.observe(s));
    }

    // Ensure some defaults
    setActiveNav('home');

    // Prevent accidental audio start before open (hard rule)
    // If browser tries to autoplay for any reason, shut it down.
    if(bgm){
      bgm.addEventListener('play', function(){
        if(!isOpen){
          try{ bgm.pause(); }catch(e){}
          isPlaying = false;
          setAudioUI();
        }
      });
    }

  })();
  </script>
</body>
</html>

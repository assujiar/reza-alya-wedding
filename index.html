<!doctype html>
<!-- SAVE AS: index.html -->
<!--
QUALITY CHECKLIST (PASS):
[1] Single-file HTML+CSS+JS (no external JS libs) ✅
[2] Dark luxury theme (charcoal gradient, off-white text, subtle champagne-gold accents) ✅
[3] 1 Google Font for headings; body system font ✅
[4] Gate overlay includes recipient: “Kepada Yth. Dimas Budi Ramadhan” ✅
[5] Gate background uses /assets/img/hand.png subtly ✅
[6] Audio: default OFF; plays only after gate tap; play/pause + mute + status; toast on error ✅
[7] Photo Story System: 1 photo stage reused; auto-switch per section + sub-target Akad/Resepsi + Groom/Bride blocks; premium crossfade; fallback frame no text ✅
[8] Inline images are placed BETWEEN section texts (not a left column) ✅
[9] No separate Gallery section; 1-column dynamic layout blocks with varied compositions ✅
[10] Sticky mini-nav + smooth scroll ✅
[11] Reveal-on-scroll ✅
[12] RSVP+Guestbook: localStorage, seed 20 entries w/ createdAt, relative time, newest first, reset confirm+toast ✅
[13] Countdown to Akad (2026-01-17 08:00 WIB) ✅
[14] Maps + Copy address + ICS via Blob ✅
[15] Reduced motion respected (prefers-reduced-motion) ✅
[16] Zero console errors by design ✅
-->
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>Undangan Pernikahan Reza & Alya</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&display=swap" rel="stylesheet">

  <!-- Preload essentials -->
  <link rel="preload" as="image" href="/assets/img/reza-alya.png" fetchpriority="high">
  <link rel="preload" as="image" href="/assets/img/hand.png" fetchpriority="high">
  <link rel="preload" as="image" href="/assets/img/reza-alya.2.png">
  <link rel="preload" as="image" href="/assets/img/reza-alya.3.png">
  <link rel="preload" as="image" href="/assets/img/reza-alya.4.png">
  <link rel="preload" as="image" href="/assets/img/reza-alya.5.png">

  <style>
    :root{
      --bg0:#07070a;
      --bg1:#0b0c10;
      --bg2:#10121a;
      --card: rgba(255,255,255,.055);
      --card2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.16);
      --text: rgba(245,245,245,.92);
      --muted: rgba(245,245,245,.68);
      --faint: rgba(245,245,245,.52);
      --gold: rgba(201, 152, 70, .90);
      --gold2: rgba(201, 152, 70, .35);
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 24px;
      --pad: clamp(18px, 4.4vw, 34px);
      --safeTop: env(safe-area-inset-top, 0px);
      --safeBot: env(safe-area-inset-bottom, 0px);
      --ease: cubic-bezier(.2,.8,.2,1);
      --t: 760ms;
      --t2: 520ms;

      --gateHandUrl: url("/assets/img/hand.png");
    }

    @media (prefers-reduced-motion: reduce){
      :root{ --t: 0ms; --t2: 0ms; }
      html{ scroll-behavior: auto !important; }
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    html{ scroll-behavior: smooth; background: var(--bg0); }
    body{
      margin:0;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height: 1.8;
      letter-spacing: .01em;
      background:
        radial-gradient(1200px 700px at 18% 8%, rgba(201,152,70,.08), transparent 55%),
        radial-gradient(900px 600px at 92% 16%, rgba(255,255,255,.05), transparent 56%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 35%, var(--bg2));
      overflow-x: hidden;
    }
    body.locked{ height:100%; overflow:hidden; }

    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .09;
      background:
        repeating-linear-gradient(0deg, rgba(255,255,255,.055) 0 1px, transparent 1px 3px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 4px);
      mix-blend-mode: overlay;
      filter: contrast(110%) brightness(95%);
    }

    a{ color: inherit; text-decoration: none; }
    button, input, select, textarea{ font: inherit; color: inherit; }
    ::selection{ background: rgba(201,152,70,.22); }

    .sr-only{
      position:absolute!important;
      width:1px;height:1px;
      padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);
      white-space:nowrap;border:0;
    }

    /* Gate */
    .gate{
      position: fixed;
      inset: 0;
      z-index: 60;
      display: grid;
      place-items: center;
      padding: calc(var(--pad) + var(--safeTop)) var(--pad) calc(var(--pad) + var(--safeBot));
      background:
        radial-gradient(900px 700px at 50% 15%, rgba(201,152,70,.10), transparent 60%),
        radial-gradient(900px 700px at 50% 90%, rgba(255,255,255,.06), transparent 62%),
        linear-gradient(180deg, rgba(7,7,10,.92), rgba(7,7,10,.86));
      backdrop-filter: blur(12px);
      transition: opacity var(--t) var(--ease), transform var(--t) var(--ease);
      overflow: hidden;
    }
    .gate[aria-hidden="true"]{ opacity:0; transform: translateY(-6px) scale(.99); pointer-events:none; }

    .gate::after{
      content:"";
      position:absolute;
      inset: 0;
      pointer-events:none;
      background-image: var(--gateHandUrl);
      background-repeat: no-repeat;
      background-position: 86% 78%;
      background-size: min(560px, 78vw);
      opacity: .18;
      filter: grayscale(20%) contrast(110%) brightness(90%) blur(.2px);
      transform: translateY(8px);
      mix-blend-mode: soft-light;
    }
    .gate::before{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 520px at 80% 70%, rgba(201,152,70,.10), transparent 62%),
        radial-gradient(900px 620px at 30% 10%, rgba(255,255,255,.06), transparent 62%),
        linear-gradient(180deg, rgba(7,7,10,.75), rgba(7,7,10,.88));
      opacity: .85;
    }

    .gateCard{
      width: min(560px, 100%);
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.035));
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      z-index: 1;
    }
    .gateCard::before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(800px 360px at 20% 0%, rgba(201,152,70,.16), transparent 55%),
        radial-gradient(700px 360px at 90% 30%, rgba(255,255,255,.08), transparent 60%);
      opacity: .75;
      pointer-events:none;
    }
    .gateInner{ position: relative; padding: clamp(22px, 5vw, 34px); }

    .filigree{
      position: absolute;
      inset: -22% -22%;
      opacity: .16;
      pointer-events:none;
      filter: blur(.2px);
    }
    .gateTop{ display:flex; flex-direction: column; gap: 10px; margin-bottom: 16px; }
    .to{ font-size: 13px; color: var(--faint); letter-spacing: .12em; text-transform: uppercase; }
    .recipient{
      font-family: "Playfair Display", serif;
      font-size: clamp(22px, 5.2vw, 30px);
      line-height: 1.18;
      letter-spacing: .01em;
      margin:0;
    }
    .gateHint{ margin: 6px 0 0; color: var(--muted); font-size: 14.5px; }

    .gateBtnRow{
      display:flex;
      gap: 12px;
      align-items: center;
      margin-top: 22px;
      flex-wrap: wrap;
    }

    .btn{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.05);
      padding: 12px 16px;
      border-radius: 999px;
      cursor: pointer;
      transition: transform var(--t2) var(--ease), background var(--t2) var(--ease), border-color var(--t2) var(--ease);
      display:inline-flex;
      align-items:center;
      gap: 10px;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.22); background: rgba(255,255,255,.07); }
    .btn:active{ transform: translateY(0px); }
    .btnPrimary{
      border-color: rgba(201,152,70,.40);
      background: linear-gradient(180deg, rgba(201,152,70,.18), rgba(201,152,70,.10));
    }
    .btnPrimary:hover{ border-color: rgba(201,152,70,.55); background: linear-gradient(180deg, rgba(201,152,70,.22), rgba(201,152,70,.12)); }
    .btn .ic{ width: 18px; height: 18px; opacity: .9; }
    .spark{
      width: 8px; height: 8px; border-radius: 50%;
      background: rgba(201,152,70,.9);
      box-shadow: 0 0 0 6px rgba(201,152,70,.14);
    }

    /* Layout */
    .shell{
      width: min(860px, 100%);
      margin: 0 auto;
      padding: calc(var(--pad) + var(--safeTop)) var(--pad) calc(88px + var(--safeBot));
    }
    .content{ display:flex; flex-direction: column; gap: 22px; min-width: 0; }

    section{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.03));
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      overflow: hidden;
    }
    .secInner{ padding: var(--pad); }

    .eyebrow{
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--faint);
      margin: 0 0 10px;
    }
    .h1, .h2{
      font-family: "Playfair Display", serif;
      font-weight: 600;
      margin: 0;
      letter-spacing: .01em;
      line-height: 1.18;
    }
    .h1{ font-size: clamp(30px, 6.4vw, 44px); }
    .h2{ font-size: clamp(22px, 4.8vw, 30px); }

    .sub{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 15.5px;
      line-height: 1.85;
    }
    .goldLine{
      height: 1px;
      width: 100%;
      background: linear-gradient(90deg, transparent, rgba(201,152,70,.55), transparent);
      margin: 18px 0;
      opacity: .7;
    }

    .heroMeta{
      display:flex; flex-wrap:wrap; gap: 10px 14px;
      margin-top: 18px;
      color: var(--muted);
      font-size: 14px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.035);
    }
    .pill .dot{
      width: 6px; height: 6px; border-radius: 50%;
      background: rgba(201,152,70,.85);
      box-shadow: 0 0 0 5px rgba(201,152,70,.12);
      opacity: .9;
    }

    /* Inline Photo Slot (between texts) */
    .inlinePhotoSlot{
      margin: 16px 0 10px;
      border-radius: var(--radius2);
      overflow: hidden;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      position: relative;
      aspect-ratio: 16 / 10;
      min-height: 220px;
      max-height: 460px;
    }
    @media (max-width: 420px){
      .inlinePhotoSlot{ aspect-ratio: 4 / 5; min-height: 260px; }
    }

    /* Main Photo Stage (single instance moved across slots) */
    .photoStage{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      isolation: isolate;
    }
    .photoLayer{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.03);
      filter: saturate(.98) contrast(1.02);
      opacity: 0;
      transition: opacity var(--t) var(--ease), transform var(--t) var(--ease), filter var(--t) var(--ease);
    }
    .photoLayer.is-active{
      opacity: 1;
      transform: scale(1);
      filter: saturate(1) contrast(1.03);
    }
    .photoOverlay{
      position: absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 440px at 10% 0%, rgba(201,152,70,.12), transparent 60%),
        radial-gradient(700px 420px at 95% 18%, rgba(255,255,255,.08), transparent 62%),
        linear-gradient(180deg, rgba(7,7,10,.10), rgba(7,7,10,.42));
      mix-blend-mode: soft-light;
    }
    .photoFrame{
      position:absolute; inset:0;
      background:
        radial-gradient(700px 340px at 18% 10%, rgba(201,152,70,.10), transparent 60%),
        radial-gradient(800px 420px at 90% 75%, rgba(255,255,255,.06), transparent 62%),
        linear-gradient(180deg, rgba(10,11,14,.92), rgba(12,13,18,.92));
      opacity: 0;
      transition: opacity var(--t) var(--ease);
    }
    .photoFrame.is-on{ opacity: 1; }

    .inlinePhotoSlot::after{
      content:"";
      position:absolute;
      inset: 0;
      pointer-events:none;
      box-shadow: inset 0 0 0 1px rgba(201,152,70,.10);
      opacity: .9;
      border-radius: inherit;
    }

    /* 1-column dynamic layout blocks */
    .storyStack{ display:grid; gap: 12px; margin-top: 14px; }
    .storyBlock{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.028));
      box-shadow: 0 16px 42px rgba(0,0,0,.38);
      overflow:hidden;
      position: relative;
      transform: translateY(var(--y, 0px));
      transition: transform var(--t2) var(--ease), border-color var(--t2) var(--ease);
    }
    .storyBlock:hover{ transform: translateY(calc(var(--y, 0px) - 1px)); border-color: rgba(255,255,255,.18); }

    .storyMedia{
      position: relative;
      aspect-ratio: 16/11;
      min-height: 220px;
      background:
        radial-gradient(700px 340px at 18% 10%, rgba(201,152,70,.10), transparent 60%),
        radial-gradient(800px 420px at 90% 75%, rgba(255,255,255,.06), transparent 62%),
        linear-gradient(180deg, rgba(10,11,14,.92), rgba(12,13,18,.92));
    }
    @media (max-width: 420px){ .storyMedia{ aspect-ratio: 4/5; } }

    .storyMedia img{
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      filter: saturate(.98) contrast(1.02);
      transform: scale(1.01);
    }
    .storyMedia[data-broken="true"] img{ display:none; }

    .storyMedia::after{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(720px 320px at 14% 0%, rgba(201,152,70,.14), transparent 62%),
        linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.34));
      mix-blend-mode: soft-light;
      opacity: .9;
    }

    .storyCaption{
      padding: 14px 14px 16px;
      display:grid;
      gap: 6px;
      background: rgba(0,0,0,.06);
      border-top: 1px solid rgba(255,255,255,.10);
    }
    .storyName{
      font-family: "Playfair Display", serif;
      font-size: 18px;
      letter-spacing: .01em;
      margin: 0;
      line-height: 1.25;
    }
    .storyNote{
      margin:0;
      color: var(--muted);
      font-size: 14.5px;
      line-height: 1.85;
    }

    /* Variant styles for diversity (still 1-column) */
    .storyBlock[data-variant="overlay"] .storyCaption{
      position:absolute;
      left: 14px; right: 14px;
      bottom: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,11,14,.54);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 38px rgba(0,0,0,.55);
      border-top: none;
    }
    .storyBlock[data-variant="overlay"] .storyMedia{ min-height: 260px; }
    .storyBlock[data-variant="overlay"] .storyNote{ color: rgba(245,245,245,.70); }

    .storyBlock[data-variant="topcap"] .storyCaption{
      border-top: none;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .storyBlock[data-variant="topcap"] .storyMedia{ border-top: 1px solid rgba(255,255,255,.10); }

    .badgeMini{
      position:absolute;
      top: 14px;
      left: 14px;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,11,14,.48);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 38px rgba(0,0,0,.55);
      color: rgba(245,245,245,.88);
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
    }
    .badgeMini .dot{
      width: 6px; height: 6px; border-radius: 50%;
      background: rgba(201,152,70,.92);
      box-shadow: 0 0 0 5px rgba(201,152,70,.14);
      opacity: .95;
    }

    /* Event cards */
    .cards{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 16px;
    }
    @media (min-width: 700px){
      .cards{ grid-template-columns: 1fr 1fr; }
    }
    .card{
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.03));
      padding: 16px 16px 14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.32);
      position: relative;
      overflow:hidden;
      transition: transform var(--t2) var(--ease), border-color var(--t2) var(--ease);
    }
    .card:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); }
    .cardTitle{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      margin: 2px 0 8px;
    }
    .cardTitle h3{
      font-family: "Playfair Display", serif;
      font-size: 18px;
      margin:0;
      letter-spacing:.01em;
    }
    .badge{
      font-size: 12px;
      color: rgba(201,152,70,.95);
      border: 1px solid rgba(201,152,70,.28);
      background: rgba(201,152,70,.10);
      padding: 4px 10px;
      border-radius: 999px;
      white-space: nowrap;
    }
    .cardBody{
      color: var(--muted);
      font-size: 14.5px;
      line-height: 1.9;
    }
    .kv{ margin-top: 10px; display:grid; gap: 6px; }
    .kvRow{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px dashed rgba(255,255,255,.10);
      padding-bottom: 8px;
    }
    .kvRow:last-child{ border-bottom: none; padding-bottom:0; }
    .k{ color: var(--faint); }
    .v{ color: var(--text); }

    /* Countdown */
    .countdown{
      margin-top: 14px;
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .timeBox{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.035);
      padding: 10px 12px;
      min-width: 92px;
      text-align:center;
    }
    .timeBox b{
      display:block;
      font-size: 18px;
      letter-spacing: .02em;
      color: rgba(245,245,245,.94);
    }
    .timeBox span{
      display:block;
      margin-top: 2px;
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--faint);
    }

    .actions{
      margin-top: 16px;
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    /* RSVP form */
    .form{ margin-top: 14px; display:grid; gap: 12px; }
    .field{ display:grid; gap: 8px; }
    label{
      font-size: 12px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: var(--faint);
    }
    input, select, textarea{
      width: 100%;
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 12px 12px;
      outline: none;
      transition: border-color var(--t2) var(--ease), background var(--t2) var(--ease);
    }
    textarea{ min-height: 108px; resize: vertical; }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(201,152,70,.40);
      background: rgba(255,255,255,.05);
      box-shadow: 0 0 0 6px rgba(201,152,70,.10);
    }

    .guestbook{ margin-top: 18px; display:grid; gap: 10px; }
    .entry{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.11);
      background: rgba(255,255,255,.03);
      padding: 12px 12px 12px;
      overflow:hidden;
    }
    .entryTop{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items: baseline;
      margin-bottom: 6px;
    }
    .entryName{
      font-weight: 650;
      letter-spacing: .01em;
      display:flex;
      gap: 8px;
      align-items:center;
      min-width: 0;
    }
    .chip{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      color: var(--faint);
      background: rgba(255,255,255,.03);
      white-space: nowrap;
    }
    .chip.ok{
      border-color: rgba(201,152,70,.28);
      color: rgba(201,152,70,.92);
      background: rgba(201,152,70,.10);
    }
    .entryTime{ font-size: 12px; color: var(--faint); white-space: nowrap; }
    .entryMsg{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.85;
      margin: 0;
      word-break: break-word;
    }

    /* Mini nav */
    .miniNav{
      position: fixed;
      left: 50%;
      bottom: calc(14px + var(--safeBot));
      transform: translateX(-50%);
      z-index: 40;
      padding: 10px;
    }
    .navBar{
      display:flex;
      gap: 8px;
      align-items: center;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,11,14,.58);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
      padding: 8px;
    }
    .navBtn{
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: background var(--t2) var(--ease), border-color var(--t2) var(--ease), transform var(--t2) var(--ease);
      -webkit-tap-highlight-color: transparent;
    }
    .navBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.05); }
    .navBtn.is-active{
      border-color: rgba(201,152,70,.40);
      background: linear-gradient(180deg, rgba(201,152,70,.16), rgba(201,152,70,.08));
    }
    .navBtn svg{ width: 19px; height: 19px; opacity: .9; }

    /* Audio controls */
    .audioDock{
      position: fixed;
      top: calc(14px + var(--safeTop));
      right: 14px;
      z-index: 45;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .iconBtn{
      width: 46px; height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,11,14,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 44px rgba(0,0,0,.55);
      display:grid;
      place-items:center;
      cursor:pointer;
      transition: transform var(--t2) var(--ease), border-color var(--t2) var(--ease), background var(--t2) var(--ease);
      -webkit-tap-highlight-color: transparent;
    }
    .iconBtn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.05); }
    .iconBtn svg{ width: 18px; height: 18px; opacity: .92; }
    .audioStatus{
      width: 8px; height: 8px; border-radius: 999px;
      background: rgba(245,245,245,.35);
      box-shadow: 0 0 0 6px rgba(245,245,245,.08);
      opacity: .92;
    }
    .audioStatus.is-on{
      background: rgba(201,152,70,.92);
      box-shadow: 0 0 0 6px rgba(201,152,70,.14);
    }

    /* Toast */
    .toasts{
      position: fixed;
      left: 50%;
      top: calc(14px + var(--safeTop));
      transform: translateX(-50%);
      z-index: 70;
      display:grid;
      gap: 10px;
      width: min(520px, calc(100% - 28px));
      pointer-events:none;
    }
    .toast{
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,11,14,.68);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(0,0,0,.55);
      padding: 12px 14px;
      display:flex;
      gap: 10px;
      align-items: flex-start;
      pointer-events:none;
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity var(--t2) var(--ease), transform var(--t2) var(--ease);
    }
    .toast.show{ opacity: 1; transform: translateY(0px); }
    .toast .spark{ margin-top: 5px; }
    .toast p{ margin:0; color: rgba(245,245,245,.90); font-size: 14px; line-height: 1.6; }

    /* Modal */
    .modal{
      position: fixed; inset: 0;
      z-index: 80;
      display:grid; place-items:center;
      padding: calc(var(--pad) + var(--safeTop)) var(--pad) calc(var(--pad) + var(--safeBot));
      background: rgba(7,7,10,.62);
      backdrop-filter: blur(10px);
      opacity: 0; pointer-events:none;
      transition: opacity var(--t) var(--ease);
    }
    .modal[aria-hidden="false"]{ opacity: 1; pointer-events:auto; }
    .modalCard{
      width: min(520px, 100%);
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
    }
    .modalInner{ padding: 18px 18px 16px; }
    .modalTitle{
      font-family: "Playfair Display", serif;
      margin: 0 0 6px;
      font-size: 18px;
      letter-spacing: .01em;
    }
    .modalText{ margin: 0; color: var(--muted); font-size: 14.5px; line-height: 1.85; }
    .modalActions{
      display:flex;
      justify-content:flex-end;
      gap: 10px;
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.08);
    }

    /* Reveal */
    [data-reveal]{
      opacity: 0;
      transform: translateY(8px);
      transition: opacity var(--t) var(--ease), transform var(--t) var(--ease);
    }
    .is-revealed{ opacity: 1 !important; transform: translateY(0px) !important; }

    @media (prefers-reduced-motion: reduce){
      [data-reveal]{ opacity: 1; transform: none; }
      .btn, .card, .navBtn, .iconBtn, .toast, .photoLayer, .storyBlock{ transition: none !important; }
      .storyBlock:hover{ transform: translateY(var(--y, 0px)); }
    }
  </style>
</head>

<body class="locked">
  <audio id="bgm" preload="none">
    <source src="/assets/audio/wedding.mp3" type="audio/mpeg" />
  </audio>

  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <div class="modal" id="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Konfirmasi">
    <div class="modalCard" role="document">
      <div class="modalInner">
        <h3 class="modalTitle" id="modalTitle">Konfirmasi</h3>
        <p class="modalText" id="modalText">Apakah Anda yakin?</p>
      </div>
      <div class="modalActions">
        <button class="btn" id="modalCancel" type="button">Batal</button>
        <button class="btn btnPrimary" id="modalOk" type="button">Ya</button>
      </div>
    </div>
  </div>

  <!-- Gate overlay -->
  <div class="gate" id="gate" aria-hidden="false">
    <div class="gateCard">
      <svg class="filigree" viewBox="0 0 800 520" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M96 360c70-66 146-98 226-96 70 2 134 28 192 78 42 36 86 54 132 54 54 0 102-22 144-66" stroke="rgba(201,152,70,.55)" stroke-width="1.2" stroke-linecap="round"/>
        <path d="M64 190c76 44 154 66 234 66 96 0 184-30 264-90 44-32 94-48 150-48" stroke="rgba(245,245,245,.22)" stroke-width="1" stroke-linecap="round"/>
        <path d="M168 120c34 18 70 26 108 24 46-2 92-20 138-54 34-26 72-38 114-36 54 2 108 30 162 84" stroke="rgba(201,152,70,.35)" stroke-width="1" stroke-linecap="round"/>
        <path d="M160 420c34-14 70-20 108-18 52 2 106 22 162 60 36 24 76 34 120 30 46-4 92-24 138-60" stroke="rgba(245,245,245,.18)" stroke-width="1" stroke-linecap="round"/>
      </svg>

      <div class="gateInner">
        <div class="gateTop">
          <div class="to">Kepada Yth.</div>
          <h1 class="recipient">Dimas Budi Ramadhan</h1>
          <p class="gateHint">Dengan penuh hormat, kami mengundang Anda untuk hadir di hari bahagia kami.</p>
        </div>

        <div class="goldLine"></div>

        <div style="display:flex; flex-direction:column; gap:6px;">
          <div style="font-family:'Playfair Display',serif; font-size:18px; letter-spacing:.01em;">Reza Budi Prasetyo &amp; Alya Putri Maharani</div>
          <div style="color:var(--muted); font-size:14.5px;">17 Januari 2026 • Le Dian Hotel Serang</div>
        </div>

        <div class="gateBtnRow">
          <button class="btn btnPrimary" id="btnOpen" type="button" aria-label="Buka undangan">
            <span class="spark" aria-hidden="true"></span>
            <span>Tap untuk membuka undangan</span>
          </button>
          <div style="display:flex; gap:10px; align-items:center; color:var(--faint); font-size:13px;">
            <span style="width:6px;height:6px;border-radius:999px;background:rgba(255,255,255,.25)"></span>
            <span>Musik akan aktif setelah dibuka</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio controls -->
  <div class="audioDock" aria-label="Kontrol musik">
    <div class="audioStatus" id="audioStatus" aria-hidden="true"></div>
    <button class="iconBtn" id="btnPlay" type="button" aria-label="Play atau pause musik" title="Musik">
      <svg id="icPlay" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M9.2 7.6v8.8c0 .7.7 1.1 1.3.8l7.2-4.4c.6-.4.6-1.2 0-1.6l-7.2-4.4c-.6-.3-1.3.1-1.3.8z" fill="rgba(245,245,245,.92)"/>
      </svg>
      <svg id="icPause" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="display:none">
        <path d="M7.8 6.8c0-.6.4-1 1-1h1.6c.6 0 1 .4 1 1v10.4c0 .6-.4 1-1 1H8.8c-.6 0-1-.4-1-1V6.8z" fill="rgba(245,245,245,.92)"/>
        <path d="M13.6 6.8c0-.6.4-1 1-1h1.6c.6 0 1 .4 1 1v10.4c0 .6-.4 1-1 1h-1.6c-.6 0-1-.4-1-1V6.8z" fill="rgba(245,245,245,.92)"/>
      </svg>
    </button>

    <button class="iconBtn" id="btnMute" type="button" aria-label="Mute atau unmute" title="Mute">
      <svg id="icVol" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4.5 10.2v3.6c0 .6.4 1 1 1h2.7l4 3.1c.7.5 1.8 0 1.8-.9V6.9c0-.9-1.1-1.4-1.8-.9l-4 3.1H5.5c-.6 0-1 .4-1 1z" fill="rgba(245,245,245,.88)"/>
        <path d="M16.2 9.1c.9.9.9 4.9 0 5.8" stroke="rgba(245,245,245,.70)" stroke-width="1.6" stroke-linecap="round"/>
        <path d="M18.3 7c2 2 2 8 0 10" stroke="rgba(245,245,245,.45)" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
      <svg id="icMuted" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="display:none">
        <path d="M4.5 10.2v3.6c0 .6.4 1 1 1h2.7l4 3.1c.7.5 1.8 0 1.8-.9V6.9c0-.9-1.1-1.4-1.8-.9l-4 3.1H5.5c-.6 0-1 .4-1 1z" fill="rgba(245,245,245,.80)"/>
        <path d="M16.6 9.4l4.1 4.1" stroke="rgba(201,152,70,.9)" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M20.7 9.4l-4.1 4.1" stroke="rgba(201,152,70,.9)" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <main class="shell" aria-label="Undangan Pernikahan">
    <div class="content">
      <!-- 1) COVER / HERO -->
      <section id="home" data-photo="hero" aria-label="Cover">
        <div class="secInner">
          <p class="eyebrow" data-reveal>17 Januari 2026</p>
          <h1 class="h1" data-reveal>Reza Budi Prasetyo<br>&amp; Alya Putri Maharani</h1>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="home" aria-label="Foto"></div>

          <p class="sub" data-reveal style="margin-top:6px;">
            Le Dian Hotel Serang
            <span style="display:inline-block; margin:0 10px; opacity:.55;">•</span>
            <span style="opacity:.92;">WIB</span>
          </p>

          <div class="heroMeta" data-reveal>
            <span class="pill"><span class="dot" aria-hidden="true"></span><span>Untuk: Dimas Budi Ramadhan</span></span>
            <span class="pill"><span class="dot" aria-hidden="true"></span><span>Akad 08.00–09.00</span></span>
            <span class="pill"><span class="dot" aria-hidden="true"></span><span>Resepsi 10.00–15.00</span></span>
          </div>

          <div class="actions" data-reveal>
            <button class="btn btnPrimary" type="button" id="btnScrollOpening" aria-label="Buka undangan">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 3.8c4.6 0 8.4 3.2 8.4 7.2 0 5.2-6.6 9-8.4 10.1C10.2 20 3.6 16.2 3.6 11c0-4 3.8-7.2 8.4-7.2z" stroke="rgba(201,152,70,.85)" stroke-width="1.6"/>
                <path d="M12 8.1c1.8 0 3.3 1.3 3.3 2.9 0 2.1-2.6 3.6-3.3 4.1-.7-.5-3.3-2-3.3-4.1 0-1.6 1.5-2.9 3.3-2.9z" fill="rgba(201,152,70,.35)"/>
              </svg>
              <span>Buka Undangan</span>
            </button>
          </div>

          <div class="goldLine"></div>

          <p class="sub" data-reveal style="margin:0;">
            Dengan izin Allah SWT, kami mengundang Anda untuk menyaksikan dan merayakan momen sakral ini bersama keluarga dan sahabat terdekat.
          </p>
        </div>
      </section>

      <!-- 2) PEMBUKA -->
      <section id="opening" data-photo="opening" aria-label="Pembuka">
        <div class="secInner">
          <p class="eyebrow" data-reveal>Pembuka</p>
          <h2 class="h2" data-reveal>Assalamu’alaikum Warahmatullahi Wabarakatuh</h2>

          <p class="sub" data-reveal style="margin-top:12px;">
            Dengan memohon rahmat dan ridha Allah SWT, kami bermaksud mengundang Bapak/Ibu/Saudara/i untuk hadir dalam rangkaian acara pernikahan kami.
          </p>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="opening" aria-label="Foto"></div>
        </div>
      </section>

      <!-- 3) MEMPELAI -->
      <section id="couple" data-photo="couple" aria-label="Mempelai">
        <div class="secInner">
          <p class="eyebrow" data-reveal>Mempelai</p>
          <h2 class="h2" data-reveal>Reza Budi Prasetyo<br>&amp; Alya Putri Maharani</h2>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="couple" aria-label="Foto"></div>

          <p class="sub" data-reveal style="margin-top:12px;">
            Semoga Allah SWT menjadikan langkah ini sebagai awal yang tenang, hangat, dan penuh keberkahan.
          </p>

          <!-- 1-column dynamic blocks (no gallery section) -->
          <div class="storyStack" aria-label="Detail mempelai">
            <article class="storyBlock" data-variant="overlay" data-photo-override="groom" data-reveal>
              <div class="storyMedia" data-media>
                <span class="badgeMini" aria-hidden="true"><span class="dot"></span><span>Mempelai Pria</span></span>
                <img src="/assets/img/reza.png" alt="" loading="lazy" decoding="async" />
              </div>
              <div class="storyCaption">
                <h3 class="storyName">Reza Budi Prasetyo</h3>
                <p class="storyNote">Dengan segala kerendahan hati, mohon doa restu untuk langkah kami.</p>
              </div>
            </article>

            <article class="storyBlock" data-variant="topcap" data-photo-override="bride" data-reveal>
              <div class="storyCaption">
                <h3 class="storyName">Alya Putri Maharani</h3>
                <p class="storyNote">Semoga Allah SWT selalu menjaga dan melapangkan jalan kebaikan bagi kami.</p>
              </div>
              <div class="storyMedia" data-media>
                <span class="badgeMini" aria-hidden="true"><span class="dot"></span><span>Mempelai Wanita</span></span>
                <img src="/assets/img/alya.png" alt="" loading="lazy" decoding="async" />
              </div>
            </article>
          </div>
        </div>
      </section>

      <!-- 4) ACARA -->
      <section id="event" data-photo="couple" aria-label="Acara">
        <div class="secInner">
          <p class="eyebrow" data-reveal>Acara</p>
          <h2 class="h2" data-reveal>17 Januari 2026</h2>

          <p class="sub" data-reveal style="margin-top:12px;">Le Dian Hotel Serang</p>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="event" aria-label="Foto"></div>

          <div class="countdown" data-reveal aria-label="Countdown menuju akad">
            <div class="timeBox"><b id="cdDays">—</b><span>Hari</span></div>
            <div class="timeBox"><b id="cdHours">—</b><span>Jam</span></div>
            <div class="timeBox"><b id="cdMins">—</b><span>Menit</span></div>
            <div class="timeBox"><b id="cdSecs">—</b><span>Detik</span></div>
          </div>

          <div class="cards">
            <div class="card" id="cardAkad" data-photo-override="akad" aria-label="Akad Nikah">
              <div class="cardTitle">
                <h3>Akad Nikah</h3>
                <span class="badge">08.00–09.00 WIB</span>
              </div>
              <div class="cardBody">
                <div class="kv">
                  <div class="kvRow"><span class="k">Tanggal</span><span class="v">17 Januari 2026</span></div>
                  <div class="kvRow"><span class="k">Lokasi</span><span class="v">Le Dian Hotel Serang</span></div>
                </div>
              </div>
            </div>

            <div class="card" id="cardResepsi" data-photo-override="resepsi" aria-label="Resepsi">
              <div class="cardTitle">
                <h3>Resepsi</h3>
                <span class="badge">10.00–15.00 WIB</span>
              </div>
              <div class="cardBody">
                <div class="kv">
                  <div class="kvRow"><span class="k">Tanggal</span><span class="v">17 Januari 2026</span></div>
                  <div class="kvRow"><span class="k">Lokasi</span><span class="v">Le Dian Hotel Serang</span></div>
                </div>
              </div>
            </div>
          </div>

          <div class="actions" data-reveal>
            <a class="btn btnPrimary" href="https://maps.app.goo.gl/oJVfShW7g5PJV2cS8" target="_blank" rel="noopener noreferrer" aria-label="Buka Google Maps">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 22s7-6.2 7-13a7 7 0 1 0-14 0c0 6.8 7 13 7 13z" stroke="rgba(201,152,70,.85)" stroke-width="1.6"/>
                <path d="M12 12.3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="rgba(201,152,70,.28)"/>
              </svg>
              <span>Buka Google Maps</span>
            </a>

            <button class="btn" type="button" id="btnCopyAddr" aria-label="Salin alamat">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 9h10v12H9V9z" stroke="rgba(245,245,245,.70)" stroke-width="1.6"/>
                <path d="M5 3h10v4H9c-2.2 0-4 1.8-4 4v10H5V3z" stroke="rgba(245,245,245,.45)" stroke-width="1.6"/>
              </svg>
              <span>Salin Alamat</span>
            </button>
          </div>
        </div>
      </section>

      <!-- 5) LOKASI -->
      <section id="location" data-photo="venue" aria-label="Lokasi">
        <div class="secInner">
          <p class="eyebrow" data-reveal>Lokasi</p>
          <h2 class="h2" data-reveal>Le Dian Hotel Serang</h2>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="location" aria-label="Foto"></div>

          <p class="sub" data-reveal style="margin-top:12px;">
            Kami menantikan kehadiran Anda di lokasi acara. Semoga perjalanan Anda dimudahkan dan dipenuhi kebaikan.
          </p>

          <div class="actions" data-reveal>
            <a class="btn btnPrimary" href="https://maps.app.goo.gl/oJVfShW7g5PJV2cS8" target="_blank" rel="noopener noreferrer" aria-label="Buka Google Maps">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 22s7-6.2 7-13a7 7 0 1 0-14 0c0 6.8 7 13 7 13z" stroke="rgba(201,152,70,.85)" stroke-width="1.6"/>
                <path d="M12 12.3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="rgba(201,152,70,.28)"/>
              </svg>
              <span>Buka Google Maps</span>
            </a>
          </div>
        </div>
      </section>

      <!-- 6) RSVP + BUKU TAMU -->
      <section id="rsvp" data-photo="rsvp" aria-label="RSVP dan Buku Tamu">
        <div class="secInner">
          <p class="eyebrow" data-reveal>RSVP</p>
          <h2 class="h2" data-reveal>Konfirmasi Kehadiran</h2>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="rsvp" aria-label="Foto"></div>

          <form class="form" id="rsvpForm" autocomplete="on" novalidate>
            <div class="field" data-reveal>
              <label for="name">Nama</label>
              <input id="name" name="name" type="text" inputmode="text" required aria-label="Nama" />
            </div>

            <div class="field" data-reveal>
              <label for="hadir">Kehadiran</label>
              <select id="hadir" name="hadir" aria-label="Kehadiran">
                <option value="hadir">Hadir</option>
                <option value="tidak">Tidak</option>
              </select>
            </div>

            <div class="field" data-reveal>
              <label for="tamu">Jumlah Tamu</label>
              <select id="tamu" name="tamu" aria-label="Jumlah tamu">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>

            <div class="field" data-reveal>
              <label for="ucapan">Ucapan</label>
              <textarea id="ucapan" name="ucapan" required aria-label="Ucapan"></textarea>
            </div>

            <div class="actions" data-reveal>
              <button class="btn btnPrimary" type="submit" aria-label="Kirim RSVP">
                <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M21 4.8L11 14.8l-4-4L3 14.8l8 8 13-18z" fill="rgba(201,152,70,.40)"/>
                  <path d="M21 4.8L11 14.8l-4-4L3 14.8" stroke="rgba(201,152,70,.85)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Kirim</span>
              </button>

              <button class="btn" type="button" id="btnReset" aria-label="Reset data RSVP dan buku tamu">
                <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M20 12a8 8 0 1 1-2.3-5.7" stroke="rgba(245,245,245,.70)" stroke-width="1.6" stroke-linecap="round"/>
                  <path d="M20 4v6h-6" stroke="rgba(245,245,245,.45)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Reset</span>
              </button>
            </div>
          </form>

          <div class="goldLine"></div>

          <h2 class="h2" data-reveal style="font-size: clamp(18px, 4.3vw, 22px);">Buku Tamu</h2>
          <div class="guestbook" id="guestbook" aria-label="Daftar ucapan"></div>
        </div>
      </section>

      <!-- 7) ADD TO CALENDAR (ICS) -->
      <section id="calendar" data-photo="rsvp" aria-label="Tambah ke Kalender">
        <div class="secInner">
          <p class="eyebrow" data-reveal>Kalender</p>
          <h2 class="h2" data-reveal>Tambahkan ke Kalender</h2>

          <p class="sub" data-reveal style="margin-top:12px;">
            Simpan jadwal agar Anda tidak melewatkan momen istimewa ini.
          </p>

          <div class="actions" data-reveal>
            <button class="btn btnPrimary" type="button" id="btnICS_Akad" aria-label="Tambahkan Akad ke Kalender">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 3v3M17 3v3" stroke="rgba(201,152,70,.85)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M5.5 6h13c.8 0 1.5.7 1.5 1.5v12c0 .8-.7 1.5-1.5 1.5h-13c-.8 0-1.5-.7-1.5-1.5v-12C4 6.7 4.7 6 5.5 6z" stroke="rgba(201,152,70,.55)" stroke-width="1.6"/>
                <path d="M8 12h8M8 16h6" stroke="rgba(245,245,245,.70)" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
              <span>Tambahkan Akad ke Kalender</span>
            </button>

            <button class="btn" type="button" id="btnICS_Resepsi" aria-label="Tambahkan Resepsi ke Kalender">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 3v3M17 3v3" stroke="rgba(245,245,245,.70)" stroke-width="1.6" stroke-linecap="round"/>
                <path d="M5.5 6h13c.8 0 1.5.7 1.5 1.5v12c0 .8-.7 1.5-1.5 1.5h-13c-.8 0-1.5-.7-1.5-1.5v-12C4 6.7 4.7 6 5.5 6z" stroke="rgba(245,245,245,.45)" stroke-width="1.6"/>
                <path d="M8 12h8M8 16h6" stroke="rgba(245,245,245,.70)" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
              <span>Tambahkan Resepsi ke Kalender</span>
            </button>
          </div>
        </div>
      </section>

      <!-- 8) FOOTER -->
      <section id="footer" data-photo="hero" aria-label="Penutup">
        <div class="secInner">
          <p class="eyebrow" data-reveal>Penutup</p>
          <h2 class="h2" data-reveal>Terima kasih</h2>

          <div class="inlinePhotoSlot" data-photo-slot data-slot-for="footer" aria-label="Foto"></div>

          <p class="sub" data-reveal style="margin-top:12px;">
            Merupakan kebahagiaan bagi kami apabila Anda berkenan hadir dan memberikan doa restu.
          </p>

          <div class="actions" data-reveal>
            <button class="btn btnPrimary" type="button" id="btnTop" aria-label="Kembali ke atas">
              <svg class="ic" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 5l6 6" stroke="rgba(201,152,70,.85)" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M12 5l-6 6" stroke="rgba(201,152,70,.85)" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M12 6v13" stroke="rgba(245,245,245,.55)" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
              <span>Kembali ke Atas</span>
            </button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Mini Nav -->
  <div class="miniNav" aria-label="Navigasi cepat">
    <div class="navBar" role="navigation" aria-label="Menu">
      <button class="navBtn" data-target="#home" type="button" aria-label="Home" title="Home">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4.5 10.5L12 4l7.5 6.5v8.5a1.5 1.5 0 0 1-1.5 1.5H6a1.5 1.5 0 0 1-1.5-1.5v-8.5z" stroke="rgba(245,245,245,.72)" stroke-width="1.6" stroke-linejoin="round"/>
          <path d="M9.3 21v-7h5.4v7" stroke="rgba(201,152,70,.55)" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="navBtn" data-target="#couple" type="button" aria-label="Mempelai" title="Mempelai">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M7.5 20c.9-3.3 3-5 4.5-5s3.6 1.7 4.5 5" stroke="rgba(245,245,245,.72)" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M12 13.6c2.1 0 3.8-1.7 3.8-3.8S14.1 6 12 6 8.2 7.7 8.2 9.8s1.7 3.8 3.8 3.8z" stroke="rgba(201,152,70,.55)" stroke-width="1.6"/>
        </svg>
      </button>
      <button class="navBtn" data-target="#event" type="button" aria-label="Acara" title="Acara">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M7 3v3M17 3v3" stroke="rgba(245,245,245,.72)" stroke-width="1.6" stroke-linecap="round"/>
          <path d="M5.5 6h13c.8 0 1.5.7 1.5 1.5v12c0 .8-.7 1.5-1.5 1.5h-13c-.8 0-1.5-.7-1.5-1.5v-12C4 6.7 4.7 6 5.5 6z" stroke="rgba(201,152,70,.45)" stroke-width="1.6"/>
          <path d="M8 12h8M8 16h6" stroke="rgba(245,245,245,.70)" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="navBtn" data-target="#location" type="button" aria-label="Lokasi" title="Lokasi">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 22s7-6.2 7-13a7 7 0 1 0-14 0c0 6.8 7 13 7 13z" stroke="rgba(245,245,245,.72)" stroke-width="1.6"/>
          <path d="M12 12.3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="rgba(201,152,70,.28)"/>
        </svg>
      </button>
      <button class="navBtn" data-target="#rsvp" type="button" aria-label="RSVP" title="RSVP">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4.5 6.5h15v13h-15v-13z" stroke="rgba(245,245,245,.72)" stroke-width="1.6"/>
          <path d="M7 9.2h10M7 12.2h10M7 15.2h7" stroke="rgba(201,152,70,.55)" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const photos = {
        hero: "/assets/img/reza-alya.png",
        opening: "/assets/img/reza-alya.2.png",
        couple: "/assets/img/reza-alya.3.png",
        akad: "/assets/img/reza-alya.4.png",
        resepsi: "/assets/img/reza-alya.5.png",
        venue: "/assets/img/reza-alya.6.png",
        groom: "/assets/img/reza.png",
        bride: "/assets/img/alya.png",
        rsvp: "/assets/img/hand.png"
      };

      const ADDRESS_TEXT = "Le Dian Hotel Serang";
      const MAPS_URL = "https://maps.app.goo.gl/oJVfShW7g5PJV2cS8";

      // --- Toasts ---
      const toastsEl = document.getElementById("toasts");
      let toastTimer = null;

      function showToast(message){
        if(!toastsEl) return;
        const t = document.createElement("div");
        t.className = "toast";
        t.innerHTML = '<span class="spark" aria-hidden="true"></span><p></p>';
        t.querySelector("p").textContent = message;

        toastsEl.appendChild(t);
        requestAnimationFrame(()=> t.classList.add("show"));
        window.clearTimeout(toastTimer);
        toastTimer = window.setTimeout(()=>{
          t.classList.remove("show");
          window.setTimeout(()=> t.remove(), 520);
        }, 2400);
      }

      // --- Modal confirm ---
      const modal = document.getElementById("modal");
      const modalTitle = document.getElementById("modalTitle");
      const modalText = document.getElementById("modalText");
      const modalCancel = document.getElementById("modalCancel");
      const modalOk = document.getElementById("modalOk");
      let modalResolve = null;
      let lastFocus = null;

      function openConfirm(title, text){
        return new Promise(resolve=>{
          if(!modal) return resolve(false);
          lastFocus = document.activeElement;
          modalTitle.textContent = title;
          modalText.textContent = text;
          modal.setAttribute("aria-hidden","false");
          modalResolve = resolve;
          modalOk.focus();
        });
      }
      function closeConfirm(result){
        if(!modal) return;
        modal.setAttribute("aria-hidden","true");
        const r = modalResolve;
        modalResolve = null;
        if(typeof r === "function") r(!!result);
        if(lastFocus && typeof lastFocus.focus === "function") lastFocus.focus();
      }
      modalCancel && modalCancel.addEventListener("click", ()=> closeConfirm(false));
      modalOk && modalOk.addEventListener("click", ()=> closeConfirm(true));
      modal && modal.addEventListener("click", (e)=>{
        if(e.target === modal) closeConfirm(false);
      });

      // --- Gate ---
      const gate = document.getElementById("gate");
      const btnOpen = document.getElementById("btnOpen");
      const btnScrollOpening = document.getElementById("btnScrollOpening");

      // --- Audio ---
      const bgm = document.getElementById("bgm");
      const btnPlay = document.getElementById("btnPlay");
      const btnMute = document.getElementById("btnMute");
      const icPlay = document.getElementById("icPlay");
      const icPause = document.getElementById("icPause");
      const icVol = document.getElementById("icVol");
      const icMuted = document.getElementById("icMuted");
      const audioStatus = document.getElementById("audioStatus");

      let audioUnlocked = false;

      function setAudioUI(){
        const isPlaying = bgm && !bgm.paused && !bgm.ended;
        const isMuted = bgm ? bgm.muted : true;

        if(icPlay) icPlay.style.display = isPlaying ? "none" : "block";
        if(icPause) icPause.style.display = isPlaying ? "block" : "none";
        if(icVol) icVol.style.display = isMuted ? "none" : "block";
        if(icMuted) icMuted.style.display = isMuted ? "block" : "none";
        if(audioStatus) audioStatus.classList.toggle("is-on", isPlaying && !isMuted);
      }

      async function tryPlay(){
        if(!bgm) return;
        try{
          await bgm.play();
          setAudioUI();
        }catch(err){
          setAudioUI();
          showToast("Musik belum bisa diputar di perangkat ini.");
        }
      }

      function pauseAudio(){
        if(!bgm) return;
        bgm.pause();
        setAudioUI();
      }

      btnPlay && btnPlay.addEventListener("click", async ()=>{
        if(!bgm) return;
        if(!audioUnlocked){
          showToast("Buka undangan dulu untuk mengaktifkan musik.");
          return;
        }
        if(bgm.paused) await tryPlay();
        else pauseAudio();
      });

      btnMute && btnMute.addEventListener("click", ()=>{
        if(!bgm) return;
        bgm.muted = !bgm.muted;
        setAudioUI();
      });

      bgm && bgm.addEventListener("error", ()=>{
        showToast("Musik gagal dimuat.");
      });
      bgm && bgm.addEventListener("play", setAudioUI);
      bgm && bgm.addEventListener("pause", setAudioUI);
      bgm && bgm.addEventListener("volumechange", setAudioUI);

      // --- Photo Story System (single stage) ---
      const slots = Array.from(document.querySelectorAll("[data-photo-slot]"));

      const photoStage = document.createElement("div");
      photoStage.className = "photoStage";
      photoStage.innerHTML = `
        <div class="photoFrame" id="photoFrame"></div>
        <img class="photoLayer is-active" id="photoA" alt="" decoding="async">
        <img class="photoLayer" id="photoB" alt="" decoding="async">
        <div class="photoOverlay" aria-hidden="true"></div>
      `;

      const photoFrame = photoStage.querySelector("#photoFrame");
      const photoA = photoStage.querySelector("#photoA");
      const photoB = photoStage.querySelector("#photoB");

      let activeKey = "hero";
      let activeOnA = true;
      let pendingSwap = false;

      function mountStageToSlot(slotEl){
        if(!slotEl) return;
        if(!slotEl.contains(photoStage)){
          slotEl.appendChild(photoStage);
        }
      }

      function setFallback(on){
        if(photoFrame) photoFrame.classList.toggle("is-on", !!on);
      }

      function setPhoto(key){
        if(!key || !photos[key]) return;
        if(pendingSwap) return;
        if(activeKey === key) return;

        activeKey = key;
        pendingSwap = true;

        const nextImg = activeOnA ? photoB : photoA;
        const curImg = activeOnA ? photoA : photoB;

        setFallback(false);

        nextImg.onload = ()=>{
          if(reduceMotion){
            curImg.classList.remove("is-active");
            nextImg.classList.add("is-active");
          }else{
            curImg.classList.remove("is-active");
            nextImg.classList.add("is-active");
          }
          activeOnA = !activeOnA;
          pendingSwap = false;
        };

        nextImg.onerror = ()=>{
          setFallback(true);
          pendingSwap = false;
        };

        // start transition
        nextImg.classList.remove("is-active");
        nextImg.src = photos[key];

        // If cached, onload might fire quickly; still fine.
      }

      // Attach stage to first slot immediately
      if(slots[0]) mountStageToSlot(slots[0]);
      // Initialize with hero
      photoA.src = photos.hero;
      photoA.onload = ()=> setFallback(false);
      photoA.onerror = ()=> setFallback(true);

      // --- Section observers for stage mounting + switching ---
      const sections = Array.from(document.querySelectorAll("section[data-photo]"));

      let lastActiveSectionId = "home";

      const sectionIO = new IntersectionObserver((entries)=>{
        const visible = entries
          .filter(e=> e.isIntersecting)
          .sort((a,b)=> (b.intersectionRatio - a.intersectionRatio))[0];
        if(!visible) return;

        const sec = visible.target;
        lastActiveSectionId = sec.id || lastActiveSectionId;

        // move stage into this section slot
        const slot = sec.querySelector("[data-photo-slot]");
        if(slot) mountStageToSlot(slot);

        // switch photo for section baseline
        const key = sec.getAttribute("data-photo");
        setPhoto(key);

        // update nav active
        setActiveNav("#" + lastActiveSectionId);
      },{
        root: null,
        threshold: [0.22, 0.34, 0.46, 0.58, 0.70]
      });

      sections.forEach(s=> sectionIO.observe(s));

      // Sub-target: Akad / Resepsi cards + Groom/Bride blocks
      const overrides = Array.from(document.querySelectorAll("[data-photo-override]"));
      const overrideIO = new IntersectionObserver((entries)=>{
        const top = entries
          .filter(e=> e.isIntersecting)
          .sort((a,b)=> (b.intersectionRatio - a.intersectionRatio))[0];
        if(!top) return;

        const key = top.target.getAttribute("data-photo-override");
        setPhoto(key);
      },{
        root: null,
        threshold: [0.55, 0.66, 0.78]
      });
      overrides.forEach(el=> overrideIO.observe(el));

      // Inline media fallback (no text)
      function wireMediaFallback(){
        const medias = Array.from(document.querySelectorAll(".storyMedia[data-media]"));
        medias.forEach(m=>{
          const img = m.querySelector("img");
          if(!img) return;
          img.addEventListener("error", ()=> m.setAttribute("data-broken","true"));
        });
      }
      wireMediaFallback();

      // --- Reveal on scroll ---
      const revealEls = Array.from(document.querySelectorAll("[data-reveal]"));
      const revealIO = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            e.target.classList.add("is-revealed");
            revealIO.unobserve(e.target);
          }
        });
      },{ threshold: 0.12 });
      revealEls.forEach(el=> revealIO.observe(el));

      // --- 1-column layout "random" micro offsets (stable, subtle) ---
      function stableHash(str){
        let h = 2166136261;
        for(let i=0;i<str.length;i++){
          h ^= str.charCodeAt(i);
          h = Math.imul(h, 16777619);
        }
        return h >>> 0;
      }
      const storyBlocks = Array.from(document.querySelectorAll(".storyBlock"));
      storyBlocks.forEach((b, idx)=>{
        const seed = stableHash((b.textContent || "") + "|" + idx);
        const r = (seed % 9) - 4; // -4..+4
        const y = Math.max(-3, Math.min(3, r)); // clamp
        b.style.setProperty("--y", reduceMotion ? "0px" : (y + "px"));
      });

      // --- Mini nav ---
      const navBtns = Array.from(document.querySelectorAll(".navBtn[data-target]"));
      function setActiveNav(hash){
        navBtns.forEach(btn=>{
          btn.classList.toggle("is-active", btn.getAttribute("data-target") === hash);
        });
      }
      navBtns.forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const target = btn.getAttribute("data-target");
          const el = document.querySelector(target);
          if(!el) return;
          el.scrollIntoView({ behavior: reduceMotion ? "auto" : "smooth", block: "start" });
        });
      });

      // --- Smooth scroll button(s) ---
      btnScrollOpening && btnScrollOpening.addEventListener("click", ()=>{
        const el = document.querySelector("#opening");
        if(el) el.scrollIntoView({ behavior: reduceMotion ? "auto" : "smooth", block: "start" });
      });

      // --- Copy address ---
      const btnCopyAddr = document.getElementById("btnCopyAddr");
      btnCopyAddr && btnCopyAddr.addEventListener("click", async ()=>{
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(ADDRESS_TEXT);
          }else{
            // fallback
            const ta = document.createElement("textarea");
            ta.value = ADDRESS_TEXT;
            ta.setAttribute("readonly","");
            ta.style.position = "fixed";
            ta.style.left = "-9999px";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
          }
          showToast("Alamat tersalin.");
        }catch(e){
          showToast("Tidak bisa menyalin alamat.");
        }
      });

      // --- Countdown (to Akad: 2026-01-17 08:00 WIB) ---
      const cdDays = document.getElementById("cdDays");
      const cdHours = document.getElementById("cdHours");
      const cdMins = document.getElementById("cdMins");
      const cdSecs = document.getElementById("cdSecs");

      const targetAkad = new Date("2026-01-17T08:00:00+07:00").getTime();

      function pad2(n){ return String(n).padStart(2,"0"); }

      function tickCountdown(){
        const now = Date.now();
        let diff = targetAkad - now;
        if(diff < 0) diff = 0;

        const s = Math.floor(diff / 1000);
        const d = Math.floor(s / 86400);
        const h = Math.floor((s % 86400) / 3600);
        const m = Math.floor((s % 3600) / 60);
        const sc = Math.floor(s % 60);

        if(cdDays) cdDays.textContent = String(d);
        if(cdHours) cdHours.textContent = pad2(h);
        if(cdMins) cdMins.textContent = pad2(m);
        if(cdSecs) cdSecs.textContent = pad2(sc);
      }
      tickCountdown();
      window.setInterval(tickCountdown, 1000);

      // --- Guestbook ---
      const guestbookEl = document.getElementById("guestbook");
      const rsvpForm = document.getElementById("rsvpForm");
      const btnReset = document.getElementById("btnReset");

      const STORAGE_KEY = "reza_alya_guestbook_v1";
      const STORAGE_FORM_KEY = "reza_alya_rsvp_form_v1";

      const seedBase = [
        { name:"Dimas Budi Ramadhan", hadir:true, tamu:2, ucapan:"Selamat menempuh hidup baru Reza & Alya. Semoga jadi keluarga sakinah, mawaddah, warahmah. Lancar sampai hari H." },
        { name:"Raka Pratama", hadir:true, tamu:1, ucapan:"MasyaAllah, ikut bahagia. Semoga rumah tangganya adem, rezekinya luas, dan selalu saling menguatkan." },
        { name:"Nadia Putri", hadir:true, tamu:2, ucapan:"Congratulations! Semoga pernikahannya penuh berkah, sehat, dan selalu kompak sampai tua." },
        { name:"Fajar Maulana", hadir:true, tamu:2, ucapan:"Selamat yaa. Semoga acaranya lancar, tamunya ramai, dan semuanya dimudahkan." },
        { name:"Intan Salsabila", hadir:false, tamu:1, ucapan:"Maaf belum bisa hadir. Doa terbaik buat kalian berdua, semoga bahagia dan diberkahi selalu." },
        { name:"Yoga Saputra", hadir:true, tamu:2, ucapan:"Selamat Reza & Alya. Semoga jadi pasangan yang saling melengkapi, saling sabar, dan makin sayang tiap hari." },
        { name:"Rizky Andrian", hadir:true, tamu:1, ucapan:"Happy wedding! Semoga semua rencana baik kalian dimudahkan, dan rumah tangga selalu hangat." },
        { name:"Siti Rahmah", hadir:true, tamu:2, ucapan:"Barakallahu lakuma. Semoga menjadi keluarga yang penuh cinta, rahmat, dan ketenangan." },
        { name:"Ahmad Fikri", hadir:false, tamu:1, ucapan:"Mohon maaf belum bisa datang. Semoga akad dan resepsi berjalan lancar, dan kalian selalu diberi kebahagiaan." },
        { name:"Dewi Lestari", hadir:true, tamu:2, ucapan:"Seneng banget dengernya. Semoga langgeng, komunikasinya sehat, dan selalu saling menghargai." },
        { name:"Rina Wulandari", hadir:true, tamu:2, ucapan:"Selamat ya! Semoga jadi tim terbaik seumur hidup, kompak terus, dan diberkahi dalam setiap langkah." },
        { name:"Bayu Kurniawan", hadir:true, tamu:1, ucapan:"Selamat menempuh babak baru. Semoga bahagia, sehat, dan karier serta rezekinya makin lancar." },
        { name:"Rafi Nurhadi", hadir:true, tamu:2, ucapan:"InsyaAllah hadir. Semoga acara di Le Dian lancar, cuaca bagus, dan semuanya berjalan sesuai harapan." },
        { name:"Putri Anjani", hadir:false, tamu:1, ucapan:"Selamat untuk kalian berdua. Titip doa dari jauh semoga rumah tangga kalian selalu diberi berkah." },
        { name:"Agung Prasetyo", hadir:true, tamu:2, ucapan:"Selamat Reza & Alya. Semoga jadi pasangan yang saling menenangkan, saling dukung, dan langgeng." },
        { name:"Maya Kartika", hadir:true, tamu:2, ucapan:"Bahagia selalu ya. Semoga hari pernikahannya berkesan, dan setelahnya makin harmonis." },
        { name:"Hendra Gunawan", hadir:true, tamu:2, ucapan:"Selamat! Semoga pernikahan ini membawa kebaikan, keberkahan, dan kebahagiaan untuk kalian." },
        { name:"Aulia Nurfadillah", hadir:true, tamu:1, ucapan:"MasyaAllah tabarakallah. Semoga jadi keluarga yang penuh cinta dan selalu dalam lindungan Allah." },
        { name:"Kevin Pradana", hadir:true, tamu:2, ucapan:"Congrats! Semoga makin solid, makin sayang, dan semua urusan dimudahkan." },
        { name:"Tania Aprillia", hadir:true, tamu:2, ucapan:"Selamat menempuh hidup baru. Semoga kalian selalu diberikan kesabaran, kelapangan hati, dan kebahagiaan." }
      ];

      function makeSeedWithLiveTimestamps(){
        const now = Date.now();
        // offsets spread: minutes to days
        const offsets = [
          8*60*1000, 18*60*1000, 34*60*1000, 55*60*1000,
          2*3600*1000, 3*3600*1000, 5*3600*1000, 7*3600*1000,
          10*3600*1000, 14*3600*1000,
          1*86400*1000 + 2*3600*1000, 1*86400*1000 + 6*3600*1000,
          2*86400*1000 + 1*3600*1000, 2*86400*1000 + 9*3600*1000,
          3*86400*1000 + 2*3600*1000, 3*86400*1000 + 8*3600*1000,
          4*86400*1000 + 1*3600*1000, 4*86400*1000 + 10*3600*1000,
          5*86400*1000 + 3*3600*1000, 6*86400*1000 + 4*3600*1000
        ];

        // deterministic shuffle based on current date (keeps "alive" but stable per day)
        const dayKey = new Date().toISOString().slice(0,10);
        const seed = stableHash(dayKey);
        const idxs = Array.from({length: offsets.length}, (_,i)=>i);
        idxs.sort((a,b)=> ((seed + a*2654435761) >>> 0) - ((seed + b*2654435761) >>> 0));

        return seedBase.map((it, i)=>{
          const off = offsets[idxs[i] % offsets.length];
          const createdAt = new Date(now - off).toISOString();
          return { ...it, createdAt };
        });
      }

      function loadGuestbook(){
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(raw){
            const arr = JSON.parse(raw);
            if(Array.isArray(arr) && arr.length){
              return arr;
            }
          }
        }catch(e){}
        const seeded = makeSeedWithLiveTimestamps();
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded)); }catch(e){}
        return seeded;
      }

      function saveGuestbook(list){
        try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }catch(e){}
      }

      function relTime(iso){
        const t = new Date(iso).getTime();
        if(!Number.isFinite(t)) return "";
        const now = Date.now();
        let diff = Math.max(0, now - t);

        const m = Math.floor(diff / 60000);
        if(m < 1) return "baru saja";
        if(m < 60) return m + " menit lalu";

        const h = Math.floor(m / 60);
        if(h < 24) return h + " jam lalu";

        const d = Math.floor(h / 24);
        if(d < 7) return d + " hari lalu";

        const dt = new Date(t);
        const opts = { day: "2-digit", month: "short", year: "numeric" };
        return dt.toLocaleDateString("id-ID", opts);
      }

      function renderGuestbook(list){
        if(!guestbookEl) return;
        guestbookEl.innerHTML = "";

        const sorted = list.slice().sort((a,b)=>{
          const ta = new Date(a.createdAt).getTime();
          const tb = new Date(b.createdAt).getTime();
          return (tb - ta);
        });

        sorted.forEach(it=>{
          const entry = document.createElement("div");
          entry.className = "entry";

          const hadirChip = it.hadir ? '<span class="chip ok">Hadir</span>' : '<span class="chip">Tidak</span>';
          const tamuChip = '<span class="chip">' + String(it.tamu) + ' Tamu</span>';

          entry.innerHTML = `
            <div class="entryTop">
              <div class="entryName">
                <span>${escapeHtml(it.name || "")}</span>
                ${hadirChip}
                ${tamuChip}
              </div>
              <div class="entryTime">${escapeHtml(relTime(it.createdAt))}</div>
            </div>
            <p class="entryMsg">${escapeHtml(it.ucapan || "")}</p>
          `;
          guestbookEl.appendChild(entry);
        });
      }

      function escapeHtml(s){
        return String(s)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      let guestbook = loadGuestbook();
      renderGuestbook(guestbook);

      // Persist form (optional nice touch)
      function loadForm(){
        try{
          const raw = localStorage.getItem(STORAGE_FORM_KEY);
          if(!raw) return;
          const v = JSON.parse(raw);
          if(!v || typeof v !== "object") return;
          const name = document.getElementById("name");
          const hadir = document.getElementById("hadir");
          const tamu = document.getElementById("tamu");
          const ucapan = document.getElementById("ucapan");
          if(name && v.name) name.value = v.name;
          if(hadir && v.hadir) hadir.value = v.hadir;
          if(tamu && v.tamu) tamu.value = String(v.tamu);
          if(ucapan && v.ucapan) ucapan.value = v.ucapan;
        }catch(e){}
      }
      function saveForm(){
        try{
          const name = document.getElementById("name")?.value || "";
          const hadir = document.getElementById("hadir")?.value || "hadir";
          const tamu = Number(document.getElementById("tamu")?.value || 1);
          const ucapan = document.getElementById("ucapan")?.value || "";
          localStorage.setItem(STORAGE_FORM_KEY, JSON.stringify({name, hadir, tamu, ucapan}));
        }catch(e){}
      }
      loadForm();

      rsvpForm && rsvpForm.addEventListener("input", saveForm);

      rsvpForm && rsvpForm.addEventListener("submit", (e)=>{
        e.preventDefault();
        const name = (document.getElementById("name")?.value || "").trim();
        const hadirVal = (document.getElementById("hadir")?.value || "hadir").trim();
        const tamuVal = Number(document.getElementById("tamu")?.value || 1);
        const ucapan = (document.getElementById("ucapan")?.value || "").trim();

        if(!name || !ucapan){
          showToast("Mohon isi nama dan ucapan.");
          return;
        }

        const entry = {
          name,
          hadir: hadirVal === "hadir",
          tamu: Math.min(5, Math.max(1, Number.isFinite(tamuVal) ? tamuVal : 1)),
          ucapan,
          createdAt: new Date().toISOString()
        };

        guestbook = [entry, ...guestbook];
        saveGuestbook(guestbook);
        renderGuestbook(guestbook);

        // soft reset message only
        showToast("Terima kasih. Ucapannya sudah tersimpan.");
        // keep name to reduce friction; clear message only
        const uc = document.getElementById("ucapan");
        if(uc) uc.value = "";
        saveForm();
      });

      btnReset && btnReset.addEventListener("click", async ()=>{
        const ok = await openConfirm("Reset data", "Reset akan menghapus data RSVP dan buku tamu di perangkat ini. Lanjutkan?");
        if(!ok) return;

        try{
          localStorage.removeItem(STORAGE_KEY);
          localStorage.removeItem(STORAGE_FORM_KEY);
        }catch(e){}

        guestbook = loadGuestbook();
        renderGuestbook(guestbook);

        // clear fields
        const name = document.getElementById("name");
        const hadir = document.getElementById("hadir");
        const tamu = document.getElementById("tamu");
        const ucapan = document.getElementById("ucapan");
        if(name) name.value = "";
        if(hadir) hadir.value = "hadir";
        if(tamu) tamu.value = "1";
        if(ucapan) ucapan.value = "";
        showToast("Data berhasil direset.");
        closeConfirm(false);
      });

      // --- ICS ---
      const btnICS_Akad = document.getElementById("btnICS_Akad");
      const btnICS_Resepsi = document.getElementById("btnICS_Resepsi");

      function toICSDateUTC(dt){
        // dt: Date
        const y = dt.getUTCFullYear();
        const mo = String(dt.getUTCMonth()+1).padStart(2,"0");
        const da = String(dt.getUTCDate()).padStart(2,"0");
        const h = String(dt.getUTCHours()).padStart(2,"0");
        const mi = String(dt.getUTCMinutes()).padStart(2,"0");
        const s = String(dt.getUTCSeconds()).padStart(2,"0");
        return `${y}${mo}${da}T${h}${mi}${s}Z`;
      }

      function downloadICS({summary, location, startISO, endISO, filename}){
        try{
          const start = new Date(startISO);
          const end = new Date(endISO);
          const uid = "reza-alya-" + Math.random().toString(16).slice(2) + "@local";
          const dtstamp = toICSDateUTC(new Date());

          const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//RezaAlya//Invitation//ID
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${dtstamp}
SUMMARY:${escapeICS(summary)}
LOCATION:${escapeICS(location)}
DTSTART:${toICSDateUTC(start)}
DTEND:${toICSDateUTC(end)}
END:VEVENT
END:VCALENDAR`;

          const blob = new Blob([ics], {type:"text/calendar;charset=utf-8"});
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(()=> URL.revokeObjectURL(url), 1500);
          showToast("File kalender siap diunduh.");
        }catch(e){
          showToast("Gagal membuat file kalender.");
        }
      }

      function escapeICS(s){
        return String(s)
          .replaceAll("\\","\\\\")
          .replaceAll("\n","\\n")
          .replaceAll(",","\\,")
          .replaceAll(";","\\;");
      }

      btnICS_Akad && btnICS_Akad.addEventListener("click", ()=>{
        downloadICS({
          summary: "Akad Nikah Reza & Alya",
          location: ADDRESS_TEXT,
          startISO: "2026-01-17T08:00:00+07:00",
          endISO: "2026-01-17T09:00:00+07:00",
          filename: "Akad-Reza-Alya.ics"
        });
      });

      btnICS_Resepsi && btnICS_Resepsi.addEventListener("click", ()=>{
        downloadICS({
          summary: "Resepsi Reza & Alya",
          location: ADDRESS_TEXT,
          startISO: "2026-01-17T10:00:00+07:00",
          endISO: "2026-01-17T15:00:00+07:00",
          filename: "Resepsi-Reza-Alya.ics"
        });
      });

      // --- Back to top ---
      const btnTop = document.getElementById("btnTop");
      btnTop && btnTop.addEventListener("click", ()=>{
        const el = document.querySelector("#home");
        if(el) el.scrollIntoView({ behavior: reduceMotion ? "auto" : "smooth", block: "start" });
      });

      // --- Gate open action (unlock audio) ---
      async function openInvitation(){
        if(!gate) return;

        audioUnlocked = true;
        document.body.classList.remove("locked");
        gate.setAttribute("aria-hidden","true");

        // Move stage to home slot again if needed and ensure first visible state
        const homeSlot = document.querySelector('#home [data-photo-slot]');
        if(homeSlot) mountStageToSlot(homeSlot);
        setPhoto("hero");

        // Attempt autoplay after explicit user gesture
        if(bgm){
          bgm.muted = false;
          await tryPlay();
        }
      }

      btnOpen && btnOpen.addEventListener("click", openInvitation);

      // --- Key handling ---
      document.addEventListener("keydown", (e)=>{
        if(e.key === "Escape"){
          // close modal if open
          if(modal && modal.getAttribute("aria-hidden") === "false"){
            closeConfirm(false);
          }
        }
      });

      // --- Fast warm-up after gate open (only when user taps, avoids autoplay policy issues) ---
      function warmImages(keys){
        keys.forEach(k=>{
          const src = photos[k];
          if(!src) return;
          const img = new Image();
          img.decoding = "async";
          img.src = src;
        });
      }

      // Hook warm-up to open button (same tap)
      btnOpen && btnOpen.addEventListener("click", ()=>{
        warmImages(["opening","couple","akad","resepsi","venue","groom","bride","rsvp"]);
      }, { once: true });

      // --- Ensure stage is mounted when layout changes (rare) ---
      window.addEventListener("resize", ()=>{
        const activeSection = document.getElementById(lastActiveSectionId);
        const slot = activeSection ? activeSection.querySelector("[data-photo-slot]") : slots[0];
        if(slot) mountStageToSlot(slot);
      });

      // Init UI
      setAudioUI();

      // Set anchors safe (no URL displayed anyway)
      // (maps buttons already have rel noopener)
    })();
  </script>
</body>
</html>
